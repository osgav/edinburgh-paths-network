"use strict";var protomapsL=(()=>{var Vr=Object.create;var He=Object.defineProperty;var Yr=Object.getOwnPropertyDescriptor;var Ir=Object.getOwnPropertyNames;var Er=Object.getPrototypeOf,Ur=Object.prototype.hasOwnProperty;var B=Math.pow;var ne=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),$r=(t,e)=>{for(var r in e)He(t,r,{get:e[r],enumerable:!0})},jt=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ir(e))!Ur.call(t,n)&&n!==r&&He(t,n,{get:()=>e[n],enumerable:!(i=Yr(e,n))||i.enumerable});return t};var J=(t,e,r)=>(r=t!=null?Vr(Er(t)):{},jt(e||!t||!t.__esModule?He(r,"default",{value:t,enumerable:!0}):r,t)),Hr=t=>jt(He({},"__esModule",{value:!0}),t);var R=(t,e,r)=>new Promise((i,n)=>{var s=l=>{try{o(r.next(l))}catch(c){n(c)}},a=l=>{try{o(r.throw(l))}catch(c){n(c)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((r=r.apply(t,e)).next())});var Q=ne((Vn,Xt)=>{"use strict";Xt.exports=ue;function ue(t,e){this.x=t,this.y=e}ue.prototype={clone:function(){return new ue(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),s=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};ue.convert=function(t){return t instanceof ue?t:Array.isArray(t)?new ue(t[0],t[1]):t}});var ut=ne((Nn,$t)=>{"use strict";var ni=Q();$t.exports=pe;function pe(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(si,this,e)}function si(t,e,r){t==1?e.id=r.readVarint():t==2?ai(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function ai(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}pe.types=["Unknown","Point","LineString","Polygon"];pe.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,s=0,a=[],o;t.pos<e;){if(i<=0){var l=t.readVarint();r=l&7,i=l>>3}if(i--,r===1||r===2)n+=t.readSVarint(),s+=t.readSVarint(),r===1&&(o&&a.push(o),o=[]),o.push(new ni(n,s));else if(r===7)o&&o.push(o[0].clone());else throw new Error("unknown command "+r)}return o&&a.push(o),a};pe.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,s=0,a=1/0,o=-1/0,l=1/0,c=-1/0;t.pos<e;){if(i<=0){var f=t.readVarint();r=f&7,i=f>>3}if(i--,r===1||r===2)n+=t.readSVarint(),s+=t.readSVarint(),n<a&&(a=n),n>o&&(o=n),s<l&&(l=s),s>c&&(c=s);else if(r!==7)throw new Error("unknown command "+r)}return[a,l,o,c]};pe.prototype.toGeoJSON=function(t,e,r){var i=this.extent*Math.pow(2,r),n=this.extent*t,s=this.extent*e,a=this.loadGeometry(),o=pe.types[this.type],l,c;function f(y){for(var _=0;_<y.length;_++){var k=y[_],u=180-(k.y+s)*360/i;y[_]=[(k.x+n)*360/i-180,360/Math.PI*Math.atan(Math.exp(u*Math.PI/180))-90]}}switch(this.type){case 1:var d=[];for(l=0;l<a.length;l++)d[l]=a[l][0];a=d,f(a);break;case 2:for(l=0;l<a.length;l++)f(a[l]);break;case 3:for(a=oi(a),l=0;l<a.length;l++)for(c=0;c<a[l].length;c++)f(a[l][c]);break}a.length===1?a=a[0]:o="Multi"+o;var p={type:"Feature",geometry:{type:o,coordinates:a},properties:this.properties};return"id"in this&&(p.id=this.id),p};function oi(t){var e=t.length;if(e<=1)return[t];for(var r=[],i,n,s=0;s<e;s++){var a=li(t[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(i&&r.push(i),i=[t[s]]):i.push(t[s]))}return i&&r.push(i),r}function li(t){for(var e=0,r=0,i=t.length,n=i-1,s,a;r<i;n=r++)s=t[r],a=t[n],e+=(a.x-s.x)*(s.y+a.y);return e}});var ht=ne((Wn,Nt)=>{"use strict";var ci=ut();Nt.exports=Ht;function Ht(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(fi,this,e),this.length=this._features.length}function fi(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(ui(r))}function ui(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}Ht.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ci(this._pbf,e,this.extent,this._keys,this._values)}});var Jt=ne((Jn,Wt)=>{"use strict";var hi=ht();Wt.exports=di;function di(t,e){this.layers=t.readFields(mi,{},e)}function mi(t,e,r){if(t===3){var i=new hi(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}});var Kt=ne((Kn,Je)=>{Je.exports.VectorTile=Jt();Je.exports.VectorTileFeature=ut();Je.exports.VectorTileLayer=ht()});var qt=ne(dt=>{dt.read=function(t,e,r,i,n){var s,a,o=n*8-i-1,l=(1<<o)-1,c=l>>1,f=-7,d=r?n-1:0,p=r?-1:1,y=t[e+d];for(d+=p,s=y&(1<<-f)-1,y>>=-f,f+=o;f>0;s=s*256+t[e+d],d+=p,f-=8);for(a=s&(1<<-f)-1,s>>=-f,f+=i;f>0;a=a*256+t[e+d],d+=p,f-=8);if(s===0)s=1-c;else{if(s===l)return a?NaN:(y?-1:1)*(1/0);a=a+Math.pow(2,i),s=s-c}return(y?-1:1)*a*Math.pow(2,s-i)};dt.write=function(t,e,r,i,n,s){var a,o,l,c=s*8-n-1,f=(1<<c)-1,d=f>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=i?0:s-1,_=i?1:-1,k=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+d>=1?e+=p/l:e+=p*Math.pow(2,1-d),e*l>=2&&(a++,l/=2),a+d>=f?(o=0,a=f):a+d>=1?(o=(e*l-1)*Math.pow(2,n),a=a+d):(o=e*Math.pow(2,d-1)*Math.pow(2,n),a=0));n>=8;t[r+y]=o&255,y+=_,o/=256,n-=8);for(a=a<<n|o,c+=n;c>0;t[r+y]=a&255,y+=_,a/=256,c-=8);t[r+y-_]|=k*128}});var rr=ne((Zn,tr)=>{"use strict";tr.exports=F;var Ke=qt();function F(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}F.Varint=0;F.Fixed64=1;F.Bytes=2;F.Fixed32=5;var mt=(1<<16)*(1<<16),Zt=1/mt,pi=12,er=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");F.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,t(n,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=qe(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Qt(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=qe(this.buf,this.pos)+qe(this.buf,this.pos+4)*mt;return this.pos+=8,t},readSFixed64:function(){var t=qe(this.buf,this.pos)+Qt(this.buf,this.pos+4)*mt;return this.pos+=8,t},readFloat:function(){var t=Ke.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ke.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,gi(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=pi&&er?Pi(this.buf,e,t):Mi(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==F.Bytes)return t.push(this.readVarint(e));var r=ee(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==F.Bytes)return t.push(this.readSVarint());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==F.Bytes)return t.push(this.readBoolean());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==F.Bytes)return t.push(this.readFloat());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==F.Bytes)return t.push(this.readDouble());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==F.Bytes)return t.push(this.readFixed32());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==F.Bytes)return t.push(this.readSFixed32());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==F.Bytes)return t.push(this.readFixed64());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==F.Bytes)return t.push(this.readSFixed64());var e=ee(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===F.Varint)for(;this.buf[this.pos++]>127;);else if(e===F.Bytes)this.pos=this.readVarint()+this.pos;else if(e===F.Fixed32)this.pos+=4;else if(e===F.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),be(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),be(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),be(this.buf,t&-1,this.pos),be(this.buf,Math.floor(t*Zt),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),be(this.buf,t&-1,this.pos),be(this.buf,Math.floor(t*Zt),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){bi(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Ci(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Gt(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Ke.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ke.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&Gt(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,F.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,wi,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,_i,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,zi,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,vi,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ki,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Ti,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Li,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Si,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Fi,e)},writeBytesField:function(t,e){this.writeTag(t,F.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,F.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,F.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,F.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,F.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,F.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,F.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,F.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,F.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,F.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function gi(t,e,r){var i=r.buf,n,s;if(s=i[r.pos++],n=(s&112)>>4,s<128||(s=i[r.pos++],n|=(s&127)<<3,s<128)||(s=i[r.pos++],n|=(s&127)<<10,s<128)||(s=i[r.pos++],n|=(s&127)<<17,s<128)||(s=i[r.pos++],n|=(s&127)<<24,s<128)||(s=i[r.pos++],n|=(s&1)<<31,s<128))return ge(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function ee(t){return t.type===F.Bytes?t.readVarint()+t.pos:t.pos+1}function ge(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function bi(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),xi(r,i,e),yi(i,e)}function xi(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function yi(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function Gt(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function wi(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function _i(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function vi(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function ki(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function zi(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Ti(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Li(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Si(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Fi(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function qe(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function be(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Qt(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Mi(t,e,r){for(var i="",n=e;n<r;){var s=t[n],a=null,o=s>239?4:s>223?3:s>191?2:1;if(n+o>r)break;var l,c,f;o===1?s<128&&(a=s):o===2?(l=t[n+1],(l&192)===128&&(a=(s&31)<<6|l&63,a<=127&&(a=null))):o===3?(l=t[n+1],c=t[n+2],(l&192)===128&&(c&192)===128&&(a=(s&15)<<12|(l&63)<<6|c&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(l=t[n+1],c=t[n+2],f=t[n+3],(l&192)===128&&(c&192)===128&&(f&192)===128&&(a=(s&15)<<18|(l&63)<<12|(c&63)<<6|f&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,i+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),i+=String.fromCharCode(a),n+=o}return i}function Pi(t,e,r){return er.decode(t.subarray(e,r))}function Ci(t,e,r){for(var i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):s=n;continue}else s&&(t[r++]=239,t[r++]=191,t[r++]=189,s=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}});var Mr=ne((Lt,St)=>{(function(t,e){typeof Lt=="object"&&typeof St!="undefined"?St.exports=e():typeof define=="function"&&define.amd?define(e):(t=t||self).RBush=e()})(Lt,function(){"use strict";function t(u,h,m,x,g){(function b(v,w,z,T,S){for(;T>z;){if(T-z>600){var P=T-z+1,A=w-z+1,ae=Math.log(P),G=.5*Math.exp(2*ae/3),Y=.5*Math.sqrt(ae*G*(P-G)/P)*(A-P/2<0?-1:1),W=Math.max(z,Math.floor(w-A*G/P+Y)),$e=Math.min(T,Math.floor(w+(P-A)*G/P+Y));b(v,w,W,$e,S)}var X=v[w],oe=z,I=T;for(e(v,z,w),S(v[T],X)>0&&e(v,z,T);oe<I;){for(e(v,oe,I),oe++,I--;S(v[oe],X)<0;)oe++;for(;S(v[I],X)>0;)I--}S(v[z],X)===0?e(v,z,I):e(v,++I,T),I<=w&&(z=I+1),w<=I&&(T=I-1)}})(u,h,m||0,x||u.length-1,g||r)}function e(u,h,m){var x=u[h];u[h]=u[m],u[m]=x}function r(u,h){return u<h?-1:u>h?1:0}var i=function(u){u===void 0&&(u=9),this._maxEntries=Math.max(4,u),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(u,h,m){if(!m)return h.indexOf(u);for(var x=0;x<h.length;x++)if(m(u,h[x]))return x;return-1}function s(u,h){a(u,0,u.children.length,h,u)}function a(u,h,m,x,g){g||(g=_(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(var b=h;b<m;b++){var v=u.children[b];o(g,u.leaf?x(v):v)}return g}function o(u,h){return u.minX=Math.min(u.minX,h.minX),u.minY=Math.min(u.minY,h.minY),u.maxX=Math.max(u.maxX,h.maxX),u.maxY=Math.max(u.maxY,h.maxY),u}function l(u,h){return u.minX-h.minX}function c(u,h){return u.minY-h.minY}function f(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function d(u){return u.maxX-u.minX+(u.maxY-u.minY)}function p(u,h){return u.minX<=h.minX&&u.minY<=h.minY&&h.maxX<=u.maxX&&h.maxY<=u.maxY}function y(u,h){return h.minX<=u.maxX&&h.minY<=u.maxY&&h.maxX>=u.minX&&h.maxY>=u.minY}function _(u){return{children:u,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function k(u,h,m,x,g){for(var b=[h,m];b.length;)if(!((m=b.pop())-(h=b.pop())<=x)){var v=h+Math.ceil((m-h)/x/2)*x;t(u,v,h,m,g),b.push(h,v,v,m)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(u){var h=this.data,m=[];if(!y(u,h))return m;for(var x=this.toBBox,g=[];h;){for(var b=0;b<h.children.length;b++){var v=h.children[b],w=h.leaf?x(v):v;y(u,w)&&(h.leaf?m.push(v):p(u,w)?this._all(v,m):g.push(v))}h=g.pop()}return m},i.prototype.collides=function(u){var h=this.data;if(!y(u,h))return!1;for(var m=[];h;){for(var x=0;x<h.children.length;x++){var g=h.children[x],b=h.leaf?this.toBBox(g):g;if(y(u,b)){if(h.leaf||p(u,b))return!0;m.push(g)}}h=m.pop()}return!1},i.prototype.load=function(u){if(!u||!u.length)return this;if(u.length<this._minEntries){for(var h=0;h<u.length;h++)this.insert(u[h]);return this}var m=this._build(u.slice(),0,u.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var x=this.data;this.data=m,m=x}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},i.prototype.insert=function(u){return u&&this._insert(u,this.data.height-1),this},i.prototype.clear=function(){return this.data=_([]),this},i.prototype.remove=function(u,h){if(!u)return this;for(var m,x,g,b=this.data,v=this.toBBox(u),w=[],z=[];b||w.length;){if(b||(b=w.pop(),x=w[w.length-1],m=z.pop(),g=!0),b.leaf){var T=n(u,b.children,h);if(T!==-1)return b.children.splice(T,1),w.push(b),this._condense(w),this}g||b.leaf||!p(b,v)?x?(m++,b=x.children[m],g=!1):b=null:(w.push(b),z.push(m),m=0,x=b,b=b.children[0])}return this},i.prototype.toBBox=function(u){return u},i.prototype.compareMinX=function(u,h){return u.minX-h.minX},i.prototype.compareMinY=function(u,h){return u.minY-h.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(u){return this.data=u,this},i.prototype._all=function(u,h){for(var m=[];u;)u.leaf?h.push.apply(h,u.children):m.push.apply(m,u.children),u=m.pop();return h},i.prototype._build=function(u,h,m,x){var g,b=m-h+1,v=this._maxEntries;if(b<=v)return s(g=_(u.slice(h,m+1)),this.toBBox),g;x||(x=Math.ceil(Math.log(b)/Math.log(v)),v=Math.ceil(b/Math.pow(v,x-1))),(g=_([])).leaf=!1,g.height=x;var w=Math.ceil(b/v),z=w*Math.ceil(Math.sqrt(v));k(u,h,m,z,this.compareMinX);for(var T=h;T<=m;T+=z){var S=Math.min(T+z-1,m);k(u,T,S,w,this.compareMinY);for(var P=T;P<=S;P+=w){var A=Math.min(P+w-1,S);g.children.push(this._build(u,P,A,x-1))}}return s(g,this.toBBox),g},i.prototype._chooseSubtree=function(u,h,m,x){for(;x.push(h),!h.leaf&&x.length-1!==m;){for(var g=1/0,b=1/0,v=void 0,w=0;w<h.children.length;w++){var z=h.children[w],T=f(z),S=(P=u,A=z,(Math.max(A.maxX,P.maxX)-Math.min(A.minX,P.minX))*(Math.max(A.maxY,P.maxY)-Math.min(A.minY,P.minY))-T);S<b?(b=S,g=T<g?T:g,v=z):S===b&&T<g&&(g=T,v=z)}h=v||h.children[0]}var P,A;return h},i.prototype._insert=function(u,h,m){var x=m?u:this.toBBox(u),g=[],b=this._chooseSubtree(x,this.data,h,g);for(b.children.push(u),o(b,x);h>=0&&g[h].children.length>this._maxEntries;)this._split(g,h),h--;this._adjustParentBBoxes(x,g,h)},i.prototype._split=function(u,h){var m=u[h],x=m.children.length,g=this._minEntries;this._chooseSplitAxis(m,g,x);var b=this._chooseSplitIndex(m,g,x),v=_(m.children.splice(b,m.children.length-b));v.height=m.height,v.leaf=m.leaf,s(m,this.toBBox),s(v,this.toBBox),h?u[h-1].children.push(v):this._splitRoot(m,v)},i.prototype._splitRoot=function(u,h){this.data=_([u,h]),this.data.height=u.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(u,h,m){for(var x,g,b,v,w,z,T,S=1/0,P=1/0,A=h;A<=m-h;A++){var ae=a(u,0,A,this.toBBox),G=a(u,A,m,this.toBBox),Y=(g=ae,b=G,v=void 0,w=void 0,z=void 0,T=void 0,v=Math.max(g.minX,b.minX),w=Math.max(g.minY,b.minY),z=Math.min(g.maxX,b.maxX),T=Math.min(g.maxY,b.maxY),Math.max(0,z-v)*Math.max(0,T-w)),W=f(ae)+f(G);Y<S?(S=Y,x=A,P=W<P?W:P):Y===S&&W<P&&(P=W,x=A)}return x||m-h},i.prototype._chooseSplitAxis=function(u,h,m){var x=u.leaf?this.compareMinX:l,g=u.leaf?this.compareMinY:c;this._allDistMargin(u,h,m,x)<this._allDistMargin(u,h,m,g)&&u.children.sort(x)},i.prototype._allDistMargin=function(u,h,m,x){u.children.sort(x);for(var g=this.toBBox,b=a(u,0,h,g),v=a(u,m-h,m,g),w=d(b)+d(v),z=h;z<m-h;z++){var T=u.children[z];o(b,u.leaf?g(T):T),w+=d(b)}for(var S=m-h-1;S>=h;S--){var P=u.children[S];o(v,u.leaf?g(P):P),w+=d(v)}return w},i.prototype._adjustParentBBoxes=function(u,h,m){for(var x=m;x>=0;x--)o(h[x],u)},i.prototype._condense=function(u){for(var h=u.length-1,m=void 0;h>=0;h--)u[h].children.length===0?h>0?(m=u[h-1].children).splice(m.indexOf(u[h]),1):this.clear():s(u[h],this.toBBox)},i})});var jn={};$r(jn,{CenteredSymbolizer:()=>Ge,CenteredTextSymbolizer:()=>re,CircleSymbolizer:()=>Ae,FlexSymbolizer:()=>zt,Font:()=>Rn,GeomType:()=>_t,GroupSymbolizer:()=>Be,IconSymbolizer:()=>vt,Index:()=>it,Justify:()=>zr,Labeler:()=>ve,Labelers:()=>ke,LineLabelPlacement:()=>Sr,LineLabelSymbolizer:()=>le,LineSymbolizer:()=>j,OffsetSymbolizer:()=>Qe,OffsetTextSymbolizer:()=>Oe,Padding:()=>Tt,PmtilesSource:()=>_e,PolygonSymbolizer:()=>D,Sheet:()=>Ct,ShieldSymbolizer:()=>kt,Static:()=>Mt,TextPlacements:()=>Tr,TextSymbolizer:()=>Re,TileCache:()=>De,View:()=>rt,ZxySource:()=>Ce,arr:()=>xn,covering:()=>Dr,createPattern:()=>bn,exp:()=>$,getZoom:()=>Ft,labelRules:()=>Xe,leafletLayer:()=>Bn,linear:()=>et,paint:()=>Ee,paintRules:()=>je,sourcesToViews:()=>Ie,step:()=>vn,toIndex:()=>se,transformGeom:()=>Ye,wrap:()=>Ve});var ie=J(Q(),1);function he(t,e,r){return Math.min(Math.max(t,r),e)}var lt=class extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}},Te=lt;function Vt(t){if(typeof t!="string")throw new Te(t);if(t.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=t.trim();e=Qr.test(t)?Jr(t):t;let r=Kr.exec(e);if(r){let a=Array.from(r).slice(1);return[...a.slice(0,3).map(o=>parseInt(Le(o,2),16)),parseInt(Le(a[3]||"f",2),16)/255]}let i=qr.exec(e);if(i){let a=Array.from(i).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,16)),parseInt(a[3]||"ff",16)/255]}let n=Zr.exec(e);if(n){let a=Array.from(n).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,10)),parseFloat(a[3]||"1")]}let s=Gr.exec(e);if(s){let[a,o,l,c]=Array.from(s).slice(1).map(parseFloat);if(he(0,100,o)!==o)throw new Te(t);if(he(0,100,l)!==l)throw new Te(t);return[...ei(a,o,l),Number.isNaN(c)?1:c]}throw new Te(t)}function Nr(t){let e=5381,r=t.length;for(;r;)e=e*33^t.charCodeAt(--r);return(e>>>0)%2341}var Yt=t=>parseInt(t.replace(/_/g,""),36),Wr="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((t,e)=>{let r=Yt(e.substring(0,3)),i=Yt(e.substring(3)).toString(16),n="";for(let s=0;s<6-i.length;s++)n+="0";return t[r]=`${n}${i}`,t},{});function Jr(t){let e=t.toLowerCase().trim(),r=Wr[Nr(e)];if(!r)throw new Te(t);return`#${r}`}var Le=(t,e)=>Array.from(Array(e)).map(()=>t).join(""),Kr=new RegExp(`^#${Le("([a-f0-9])",3)}([a-f0-9])?$`,"i"),qr=new RegExp(`^#${Le("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),Zr=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Le(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),Gr=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,Qr=/^[a-z]+$/i,It=t=>Math.round(t*255),ei=(t,e,r)=>{let i=r/100;if(e===0)return[i,i,i].map(It);let n=(t%360+360)%360/60,s=(1-Math.abs(2*i-1))*(e/100),a=s*(1-Math.abs(n%2-1)),o=0,l=0,c=0;n>=0&&n<1?(o=s,l=a):n>=1&&n<2?(o=a,l=s):n>=2&&n<3?(l=s,c=a):n>=3&&n<4?(l=a,c=s):n>=4&&n<5?(o=a,c=s):n>=5&&n<6&&(o=s,c=a);let f=i-s/2,d=o+f,p=l+f,y=c+f;return[d,p,y].map(It)};function ti(t,e,r,i){return`rgba(${he(0,255,t).toFixed()}, ${he(0,255,e).toFixed()}, ${he(0,255,r).toFixed()}, ${parseFloat(he(0,1,i).toFixed(3))})`}function Ne(t,e,r){let i=(b,v)=>v===3?b:b/255,[n,s,a,o]=Vt(t).map(i),[l,c,f,d]=Vt(e).map(i),p=d-o,y=r*2-1,k=((y*p===-1?y:y+p/(1+y*p))+1)/2,u=1-k,h=(n*u+l*k)*255,m=(s*u+c*k)*255,x=(a*u+f*k)*255,g=d*r+o*(1-r);return ti(h,m,x,g)}var Z=J(Q(),1);var O=class{constructor(e,r){this.str=e!=null?e:r,this.perFeature=typeof this.str=="function"&&this.str.length===2}get(e,r){return typeof this.str=="function"?this.str(e,r):this.str}},C=class{constructor(e,r=1){this.value=e!=null?e:r,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}},de=class{constructor(e){var r;this.labelProps=(r=e==null?void 0:e.labelProps)!=null?r:["name"],this.textTransform=e==null?void 0:e.textTransform}get(e,r){let i,n;typeof this.labelProps=="function"?n=this.labelProps(e,r):n=this.labelProps;for(let a of n)if(Object.prototype.hasOwnProperty.call(r.props,a)&&typeof r.props[a]=="string"){i=r.props[a];break}let s;return typeof this.textTransform=="function"?s=this.textTransform(e,r):s=this.textTransform,i&&s==="uppercase"?i=i.toUpperCase():i&&s==="lowercase"?i=i.toLowerCase():i&&s==="capitalize"&&(i=i.toLowerCase().split(" ").map(l=>l[0].toUpperCase()+l.slice(1)).join(" ")),i}},me=class{constructor(e){var r,i;e!=null&&e.font?this.font=e.font:(this.family=(r=e==null?void 0:e.fontFamily)!=null?r:"sans-serif",this.size=(i=e==null?void 0:e.fontSize)!=null?i:12,this.weight=e==null?void 0:e.fontWeight,this.style=e==null?void 0:e.fontStyle)}get(e,r){if(this.font)return typeof this.font=="function"?this.font(e,r):this.font;let i="";this.style&&(typeof this.style=="function"?i=`${this.style(e,r)} `:i=`${this.style} `);let n="";this.weight&&(typeof this.weight=="function"?n=`${this.weight(e,r)} `:n=`${this.weight} `);let s;typeof this.size=="function"?s=this.size(e,r):s=this.size;let a;return typeof this.family=="function"?a=this.family(e,r):a=this.family,`${i}${n}${s}px ${a}`}},We=class{constructor(e,r=[]){this.value=e!=null?e:r,this.perFeature=typeof this.value=="function"&&this.value.length===2}get(e,r){return typeof this.value=="function"?this.value(e,r):this.value}};var ct=J(Q(),1);var ri=(t,e,r)=>{let i=[],n,s,a,o=0,l=0,c=0,f=0,d=0,p=0,y=0,_=0,k=0,u=0,h=0,m=0;if(t.length<2)return[];if(t.length===2)return c=Math.sqrt(B(t[1].x-t[0].x,2)+B(t[1].y-t[0].y,2)),[{length:c,beginIndex:0,beginDistance:0,endIndex:2,endDistance:c}];for(f=Math.sqrt(B(t[1].x-t[0].x,2)+B(t[1].y-t[0].y,2)),o=1,l=t.length-1;o<l;o++)n=t[o-1],s=t[o],a=t[o+1],p=s.x-n.x,y=s.y-n.y,_=a.x-s.x,k=a.y-s.y,d=Math.sqrt(_*_+k*k),c+=f,u=Math.acos((p*_+y*k)/(f*d)),(u>e||c-m>r)&&(i.push({length:c-m,beginDistance:m,beginIndex:h,endIndex:o+1,endDistance:c}),h=o,m=c),f=d;return o-h>0&&i.push({length:c-m+d,beginIndex:h,beginDistance:m,endIndex:o+1,endDistance:c+d}),i};function Et(t,e,r,i){let n=[];for(let s of t){let a=ri(s,Math.PI/45,e);for(let o of a)if(o.length>=e+i){let l=new ct.default(s[o.beginIndex].x,s[o.beginIndex].y),c=s[o.endIndex-1],f=new ct.default((c.x-l.x)/o.length,(c.y-l.y)/o.length);for(let d=i;d<o.length-e;d+=r)n.push({start:l.add(f.mult(d)),end:l.add(f.mult(d+e))})}}return n}function Ut(t,e,r,i){let n=e.x-t.x,s=e.y-t.y,a=Math.sqrt(B(e.x-t.x,2)+B(e.y-t.y,2)),o=[];for(let l=0;l<r+i;l+=2*i){let c=l*1/a;o.push({x:t.x+c*n,y:t.y+c*s})}return o}function ft(t,e){if(t.length<=e)return[t];let r=e-1,i=t.lastIndexOf(" ",r),n=t.indexOf(" ",r);if(i===-1&&n===-1)return[t];let s,a;return n===-1||i>=0&&r-i<n-r?(s=t.substring(0,i),a=t.substring(i+1,t.length)):(s=t.substring(0,n),a=t.substring(n+1,t.length)),[s,...ft(a,e)]}var ii="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",$n=new RegExp(`^[${ii}]+$`);var wr=J(Q(),1),_r=J(Kt(),1),vr=J(rr(),1);var we=Math.pow,V=(t,e,r)=>new Promise((i,n)=>{var s=l=>{try{o(r.next(l))}catch(c){n(c)}},a=l=>{try{o(r.throw(l))}catch(c){n(c)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,a);o((r=r.apply(t,e)).next())}),U=Uint8Array,ye=Uint16Array,Di=Int32Array,sr=new U([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ar=new U([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ai=new U([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),or=function(t,e){for(var r=new ye(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];for(var n=new Di(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return{b:r,r:n}},lr=or(sr,2),cr=lr.b,Bi=lr.r;cr[28]=258,Bi[258]=28;var fr=or(ar,0),Ri=fr.b,Gn=fr.r,bt=new ye(32768);for(M=0;M<32768;++M)te=(M&43690)>>1|(M&21845)<<1,te=(te&52428)>>2|(te&13107)<<2,te=(te&61680)>>4|(te&3855)<<4,bt[M]=((te&65280)>>8|(te&255)<<8)>>1;var te,M,Me=function(t,e,r){for(var i=t.length,n=0,s=new ye(e);n<i;++n)t[n]&&++s[t[n]-1];var a=new ye(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(r){o=new ye(1<<e);var l=15-e;for(n=0;n<i;++n)if(t[n])for(var c=n<<4|t[n],f=e-t[n],d=a[t[n]-1]++<<f,p=d|(1<<f)-1;d<=p;++d)o[bt[d]>>l]=c}else for(o=new ye(i),n=0;n<i;++n)t[n]&&(o[n]=bt[a[t[n]-1]++]>>15-t[n]);return o},Pe=new U(288);for(M=0;M<144;++M)Pe[M]=8;var M;for(M=144;M<256;++M)Pe[M]=9;var M;for(M=256;M<280;++M)Pe[M]=7;var M;for(M=280;M<288;++M)Pe[M]=8;var M,ur=new U(32);for(M=0;M<32;++M)ur[M]=5;var M,Oi=Me(Pe,9,1),ji=Me(ur,5,1),pt=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},K=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&r},gt=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Xi=function(t){return(t+7)/8|0},Vi=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var i=new U(r-e);return i.set(t.subarray(e,r)),i},Yi=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,e,r){var i=new Error(e||Yi[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,E),!r)throw i;return i},wt=function(t,e,r,i){var n=t.length,s=i?i.length:0;if(!n||e.f&&!e.l)return r||new U(0);var a=!r||e.i!=2,o=e.i;r||(r=new U(n*3));var l=function(Bt){var Rt=r.length;if(Bt>Rt){var Ot=new U(Math.max(Rt*2,Bt));Ot.set(r),r=Ot}},c=e.f||0,f=e.p||0,d=e.b||0,p=e.l,y=e.d,_=e.m,k=e.n,u=n*8;do{if(!p){c=K(t,f,1);var h=K(t,f+1,3);if(f+=3,h)if(h==1)p=Oi,y=ji,_=9,k=5;else if(h==2){var b=K(t,f,31)+257,v=K(t,f+10,15)+4,w=b+K(t,f+5,31)+1;f+=14;for(var z=new U(w),T=new U(19),S=0;S<v;++S)T[Ai[S]]=K(t,f+S*3,7);f+=v*3;for(var P=pt(T),A=(1<<P)-1,ae=Me(T,P,1),S=0;S<w;){var G=ae[K(t,f,A)];f+=G&15;var m=G>>4;if(m<16)z[S++]=m;else{var Y=0,W=0;for(m==16?(W=3+K(t,f,3),f+=2,Y=z[S-1]):m==17?(W=3+K(t,f,7),f+=3):m==18&&(W=11+K(t,f,127),f+=7);W--;)z[S++]=Y}}var $e=z.subarray(0,b),X=z.subarray(b);_=pt($e),k=pt(X),p=Me($e,_,1),y=Me(X,k,1)}else E(1);else{var m=Xi(f)+4,x=t[m-4]|t[m-3]<<8,g=m+x;if(g>n){o&&E(0);break}a&&l(d+x),r.set(t.subarray(m,g),d),e.b=d+=x,e.p=f=g*8,e.f=c;continue}if(f>u){o&&E(0);break}}a&&l(d+131072);for(var oe=(1<<_)-1,I=(1<<k)-1,nt=f;;nt=f){var Y=p[gt(t,f)&oe],fe=Y>>4;if(f+=Y&15,f>u){o&&E(0);break}if(Y||E(2),fe<256)r[d++]=fe;else if(fe==256){nt=f,p=null;break}else{var Dt=fe-254;if(fe>264){var S=fe-257,ze=sr[S];Dt=K(t,f,(1<<ze)-1)+cr[S],f+=ze}var st=y[gt(t,f)&I],at=st>>4;st||E(3),f+=st&15;var X=Ri[at];if(at>3){var ze=ar[at];X+=gt(t,f)&(1<<ze)-1,f+=ze}if(f>u){o&&E(0);break}a&&l(d+131072);var ot=d+Dt;if(d<X){var At=s-X,Xr=Math.min(X,ot);for(At+d<0&&E(3);d<Xr;++d)r[d]=i[At+d]}for(;d<ot;d+=4)r[d]=r[d-X],r[d+1]=r[d+1-X],r[d+2]=r[d+2-X],r[d+3]=r[d+3-X];d=ot}}e.l=p,e.p=nt,e.b=d,e.f=c,p&&(c=1,e.m=_,e.d=y,e.n=k)}while(!c);return d==r.length?r:Vi(r,0,d)},Ii=new U(0),Ei=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&E(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(e&2)},Ui=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},$i=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&E(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&E(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function Hi(t,e){return wt(t,{i:2},e&&e.out,e&&e.dictionary)}function Ni(t,e){var r=Ei(t);return r+8>t.length&&E(6,"invalid gzip data"),wt(t.subarray(r,-8),{i:2},e&&e.out||new U(Ui(t)),e&&e.dictionary)}function Wi(t,e){return wt(t.subarray($i(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function xt(t,e){return t[0]==31&&t[1]==139&&t[2]==8?Ni(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?Hi(t,e):Wi(t,e)}var Ji=typeof TextDecoder!="undefined"&&new TextDecoder,Ki=0;try{Ji.decode(Ii,{stream:!0}),Ki=1}catch(t){}var hr=(t,e)=>t*we(2,e),Se=(t,e)=>Math.floor(t/we(2,e)),Ze=(t,e)=>hr(t.getUint16(e+1,!0),8)+t.getUint8(e),dr=(t,e)=>hr(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),qi=(t,e,r,i,n)=>{if(t!==i.getUint8(n))return t-i.getUint8(n);let s=Ze(i,n+1);if(e!==s)return e-s;let a=Ze(i,n+4);return r!==a?r-a:0},Zi=(t,e,r,i)=>{let n=mr(t,e|128,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!0}:null},ir=(t,e,r,i)=>{let n=mr(t,e,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!1}:null},mr=(t,e,r,i)=>{let n=0,s=t.byteLength/17-1;for(;n<=s;){let a=s+n>>1,o=qi(e,r,i,t,a*17);if(o>0)n=a+1;else if(o<0)s=a-1;else return[dr(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},Gi=(t,e)=>t.isDir&&!e.isDir?1:!t.isDir&&e.isDir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,pr=(t,e)=>{let r=t.getUint8(e*17);return{z:r&127,x:Ze(t,e*17+1),y:Ze(t,e*17+4),offset:dr(t,e*17+7),length:t.getUint32(e*17+13,!0),isDir:r>>7===1}},nr=t=>{let e=[],r=new DataView(t);for(let i=0;i<r.byteLength/17;i++)e.push(pr(r,i));return Qi(e)},Qi=t=>{t.sort(Gi);let e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++){let n=t[i],s=n.z;n.isDir&&(s=s|128),r[i*17]=s,r[i*17+1]=n.x&255,r[i*17+2]=n.x>>8&255,r[i*17+3]=n.x>>16&255,r[i*17+4]=n.y&255,r[i*17+5]=n.y>>8&255,r[i*17+6]=n.y>>16&255,r[i*17+7]=n.offset&255,r[i*17+8]=Se(n.offset,8)&255,r[i*17+9]=Se(n.offset,16)&255,r[i*17+10]=Se(n.offset,24)&255,r[i*17+11]=Se(n.offset,32)&255,r[i*17+12]=Se(n.offset,48)&255,r[i*17+13]=n.length&255,r[i*17+14]=n.length>>8&255,r[i*17+15]=n.length>>16&255,r[i*17+16]=n.length>>24&255}return e},en=(t,e)=>{if(t.byteLength<17)return null;let r=t.byteLength/17,i=pr(t,r-1);if(i.isDir){let n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),o=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:o}}return null};function tn(t){return V(this,null,function*(){let e=yield t.getBytes(0,512e3),r=new DataView(e.data),i=r.getUint32(4,!0),n=r.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i))),o=0;a.compression==="gzip"&&(o=2);let l=0;"minzoom"in a&&(l=+a.minzoom);let c=0;"maxzoom"in a&&(c=+a.maxzoom);let f=0,d=0,p=0,y=-180,_=-85,k=180,u=85;if(a.bounds){let m=a.bounds.split(",");y=+m[0],_=+m[1],k=+m[2],u=+m[3]}if(a.center){let m=a.center.split(",");f=+m[0],d=+m[1],p=+m[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:l,maxZoom:c,minLon:y,minLat:_,maxLon:k,maxLat:u,centerZoom:p,centerLon:f,centerLat:d,etag:e.etag}})}function rn(t,e,r,i,n,s,a){return V(this,null,function*(){let o=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(o=nr(o));let l=ir(new DataView(o),i,n,s);if(l){let d=(yield e.getBytes(l.offset,l.length,a)).data,p=new DataView(d);return p.getUint8(0)===31&&p.getUint8(1)===139&&(d=xt(new Uint8Array(d))),{data:d}}let c=en(new DataView(o),{z:i,x:n,y:s});if(c){let f=Zi(new DataView(o),c.z,c.x,c.y);if(f){let d=yield r.getArrayBuffer(e,f.offset,f.length,t);t.specVersion===1&&(d=nr(d));let p=ir(new DataView(d),i,n,s);if(p){let _=(yield e.getBytes(p.offset,p.length,a)).data,k=new DataView(_);return k.getUint8(0)===31&&k.getUint8(1)===139&&(_=xt(new Uint8Array(_))),{data:_}}}}})}var gr={getHeader:tn,getZxy:rn};function xe(t,e){return(e>>>0)*4294967296+(t>>>0)}function nn(t,e){let r=e.buf,i=r[e.pos++],n=(i&112)>>4;if(i<128||(i=r[e.pos++],n|=(i&127)<<3,i<128)||(i=r[e.pos++],n|=(i&127)<<10,i<128)||(i=r[e.pos++],n|=(i&127)<<17,i<128)||(i=r[e.pos++],n|=(i&127)<<24,i<128)||(i=r[e.pos++],n|=(i&1)<<31,i<128))return xe(t,n);throw new Error("Expected varint not more than 10 bytes")}function Fe(t){let e=t.buf,r=e[t.pos++],i=r&127;return r<128||(r=e[t.pos++],i|=(r&127)<<7,r<128)||(r=e[t.pos++],i|=(r&127)<<14,r<128)||(r=e[t.pos++],i|=(r&127)<<21,r<128)?i:(r=e[t.pos],i|=(r&15)<<28,nn(i,t))}function sn(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var an=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function on(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>we(2,t)-1||r>we(2,t)-1)throw Error("tile x/y outside zoom level bounds");let i=an[t],n=we(2,t),s=0,a=0,o=0,l=[e,r],c=n/2;for(;c>0;)s=(l[0]&c)>0?1:0,a=(l[1]&c)>0?1:0,o+=c*c*(3*s^a),sn(c,l,s,a),c=c/2;return i+o}function br(t,e){return V(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream=="undefined")return xt(new Uint8Array(t));let r=new Response(t).body;if(!r)throw Error("Failed to read response stream");let i=r.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}var ln=127;function cn(t,e){let r=0,i=t.length-1;for(;r<=i;){let n=i+r>>1,s=e-t[n].tileId;if(s>0)r=n+1;else if(s<0)i=n-1;else return t[n]}return i>=0&&(t[i].runLength===0||e-t[i].tileId<t[i].runLength)?t[i]:null}var fn=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,r,i){return V(this,null,function*(){let n,s;r?s=r:(n=new AbortController,s=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${t}-${t+e-1}`);let o;this.mustReload&&(o="reload");let l=yield fetch(this.url,{signal:s,cache:o,headers:a});if(t===0&&l.status===416){let p=l.headers.get("Content-Range");if(!p||!p.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let y=+p.substr(8);l=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${y-1}`}})}let c=l.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),l.status===416||i&&c&&c!==i)throw this.mustReload=!0,new yt(i);if(l.status>=300)throw Error(`Bad response code: ${l.status}`);let f=l.headers.get("Content-Length");if(l.status===200&&(!f||+f>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield l.arrayBuffer(),etag:c||void 0,cacheControl:l.headers.get("Cache-Control")||void 0,expires:l.headers.get("Expires")||void 0}})}};function q(t,e){let r=t.getUint32(e+4,!0),i=t.getUint32(e+0,!0);return r*we(2,32)+i}function un(t,e){let r=new DataView(t),i=r.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:q(r,8),rootDirectoryLength:q(r,16),jsonMetadataOffset:q(r,24),jsonMetadataLength:q(r,32),leafDirectoryOffset:q(r,40),leafDirectoryLength:q(r,48),tileDataOffset:q(r,56),tileDataLength:q(r,64),numAddressedTiles:q(r,72),numTileEntries:q(r,80),numTileContents:q(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function xr(t){let e={buf:new Uint8Array(t),pos:0},r=Fe(e),i=[],n=0;for(let s=0;s<r;s++){let a=Fe(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<r;s++)i[s].runLength=Fe(e);for(let s=0;s<r;s++)i[s].length=Fe(e);for(let s=0;s<r;s++){let a=Fe(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function hn(t){let e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var yt=class extends Error{};function dn(t,e){return V(this,null,function*(){let r=yield t.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(hn(r.data)<3)return[yield gr.getHeader(t)];let n=r.data.slice(0,ln),s=un(n,r.etag),a=r.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),o=`${t.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,l=xr(yield e(a,s.internalCompression));return[s,[o,l.length,l]]})}function mn(t,e,r,i,n){return V(this,null,function*(){let s=yield t.getBytes(r,i,void 0,n.etag),a=yield e(s.data,n.internalCompression),o=xr(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var pn=class{constructor(t=100,e=!0,r=br){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=r}getHeader(t){return V(this,null,function*(){let e=t.getKey(),r=this.cache.get(e);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((n,s)=>{dn(t,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,r,i){return V(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{mn(t,this.decompress,e,r,i).then(c=>{o(c),this.prune()}).catch(c=>{l(c)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(t,e,r,i){return V(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((o,l)=>{t.getBytes(e,r,void 0,i.etag).then(c=>{o(c.data),this.cache.has(n),this.prune()}).catch(c=>{l(c)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t){return V(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let r=new Promise((i,n)=>{this.getHeader(t).then(s=>{i(),this.invalidations.delete(e)}).catch(s=>{n(s)})});this.invalidations.set(e,r)})}},yr=class{constructor(t,e,r){typeof t=="string"?this.source=new fn(t):this.source=t,r?this.decompress=r:this.decompress=br,e?this.cache=e:this.cache=new pn}getHeader(){return V(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,i){return V(this,null,function*(){let n=on(t,e,r),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return gr.getZxy(s,this.source,this.cache,t,e,r,i);if(t<s.minZoom||t>s.maxZoom)return;let a=s.rootDirectoryOffset,o=s.rootDirectoryLength;for(let l=0;l<=3;l++){let c=yield this.cache.getDirectory(this.source,a,o,s),f=cn(c,n);if(f){if(f.runLength>0){let d=yield this.source.getBytes(s.tileDataOffset+f.offset,f.length,i,s.etag);return{data:yield this.decompress(d.data,s.tileCompression),cacheControl:d.cacheControl,expires:d.expires}}a=s.leafDirectoryOffset+f.offset,o=f.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,i){return V(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,i)}catch(n){if(n instanceof yt)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,r,i);throw n}})}getMetadataAttempt(){return V(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),r=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return V(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof yt)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}};var _t=(i=>(i[i.Point=1]="Point",i[i.Line=2]="Line",i[i.Polygon=3]="Polygon",i))(_t||{});function se(t){return`${t.x}:${t.y}:${t.z}`}var gn=(t,e,r)=>{t.pos=e;let i=t.readVarint()+t.pos,n=1,s=0,a=0,o=0,l=1/0,c=-1/0,f=1/0,d=-1/0,p=[],y=[];for(;t.pos<i;){if(s<=0){let _=t.readVarint();n=_&7,s=_>>3}if(s--,n===1||n===2)a+=t.readSVarint()*r,o+=t.readSVarint()*r,a<l&&(l=a),a>c&&(c=a),o<f&&(f=o),o>d&&(d=o),n===1&&(y.length>0&&p.push(y),y=[]),y.push(new wr.default(a,o));else if(n===7)y&&y.push(y[0].clone());else throw new Error(`unknown command ${n}`)}return y&&p.push(y),{geom:p,bbox:{minX:l,minY:f,maxX:c,maxY:d}}};function kr(t,e){let r=new _r.VectorTile(new vr.default(t)),i=new Map;for(let[n,s]of Object.entries(r.layers)){let a=[],o=s;for(let l=0;l<o.length;l++){let c=gn(o.feature(l)._pbf,o.feature(l)._geometry,e/o.extent),f=0;for(let d of c.geom)f+=d.length;a.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:c.geom,numVertices:f,bbox:c.bbox,props:o.feature(l).properties})}i.set(n,a)}return i}var _e=class{constructor(e,r){typeof e=="string"?this.p=new yr(e):this.p=e,this.zoomaborts=[],this.shouldCancelZooms=r}get(e,r){return R(this,null,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let i=new AbortController;this.zoomaborts.push({z:e.z,controller:i});let n=i.signal,s=yield this.p.getZxy(e.z,e.x,e.y,n);return s?kr(s.data,r):new Map})}},Ce=class{constructor(e,r){this.url=e,this.zoomaborts=[],this.shouldCancelZooms=r}get(e,r){return R(this,null,function*(){this.shouldCancelZooms&&(this.zoomaborts=this.zoomaborts.filter(a=>a.z!==e.z?(a.controller.abort(),!1):!0));let i=this.url.replace("{z}",e.z.toString()).replace("{x}",e.x.toString()).replace("{y}",e.y.toString()),n=new AbortController;this.zoomaborts.push({z:e.z,controller:n});let s=n.signal;return new Promise((a,o)=>{fetch(i,{signal:s}).then(l=>l.arrayBuffer()).then(l=>{let c=kr(l,r);a(c)}).catch(l=>{o(l)})})})}},De=class{constructor(e,r){this.source=e,this.cache=new Map,this.inflight=new Map,this.tileSize=r}get(e){return R(this,null,function*(){let r=se(e);return new Promise((i,n)=>{let s=this.cache.get(r);if(s)s.used=performance.now(),i(s.data);else{let a=this.inflight.get(r);a?a.push({resolve:i,reject:n}):(this.inflight.set(r,[]),this.source.get(e,this.tileSize).then(o=>{this.cache.set(r,{used:performance.now(),data:o});let l=this.inflight.get(r);if(l)for(let c of l)c.resolve(o);if(this.inflight.delete(r),i(o),this.cache.size>=64){let c=1/0,f;this.cache.forEach((d,p)=>{d.used<c&&(c=d.used,f=p)}),f&&this.cache.delete(f)}}).catch(o=>{let l=this.inflight.get(r);if(l)for(let c of l)c.reject(o);this.inflight.delete(r),n(o)}))}})})}};var zr=(i=>(i[i.Left=1]="Left",i[i.Center=2]="Center",i[i.Right=3]="Right",i))(zr||{}),Tr=(l=>(l[l.N=1]="N",l[l.Ne=2]="Ne",l[l.E=3]="E",l[l.Se=4]="Se",l[l.S=5]="S",l[l.Sw=6]="Sw",l[l.W=7]="W",l[l.Nw=8]="Nw",l))(Tr||{}),bn=(t,e,r)=>{let i=document.createElement("canvas"),n=i.getContext("2d");return i.width=t,i.height=e,n!==null&&r(i,n),i},D=class{constructor(e){var r;this.pattern=e.pattern,this.fill=new O(e.fill,"black"),this.opacity=new C(e.opacity,1),this.stroke=new O(e.stroke,"black"),this.width=new C(e.width,0),this.perFeature=(r=this.fill.perFeature||this.opacity.perFeature||this.stroke.perFeature||this.width.perFeature||e.perFeature)!=null?r:!1,this.doStroke=!1}before(e,r){if(!this.perFeature){e.globalAlpha=this.opacity.get(r),e.fillStyle=this.fill.get(r),e.strokeStyle=this.stroke.get(r);let i=this.width.get(r);i>0&&(this.doStroke=!0),e.lineWidth=i}if(this.pattern){let i=e.createPattern(this.pattern,"repeat");i&&(e.fillStyle=i)}}draw(e,r,i,n){let s=!1;if(this.perFeature){e.globalAlpha=this.opacity.get(i,n),e.fillStyle=this.fill.get(i,n);let o=this.width.get(i,n);o&&(s=!0,e.strokeStyle=this.stroke.get(i,n),e.lineWidth=o)}let a=()=>{e.fill(),(s||this.doStroke)&&e.stroke()};e.beginPath();for(let o of r)for(let l=0;l<o.length;l++){let c=o[l];l===0?e.moveTo(c.x,c.y):e.lineTo(c.x,c.y)}a()}};function xn(t,e){return r=>{let i=r-t;return i>=0&&i<e.length?e[i]:0}}function yn(t,e){let r=0;for(;e[r+1][0]<t;)r++;return r}function wn(t,e,r){return t*(r-e)+e}function _n(t,e,r,i){let n=i[e+1][0]-i[e][0],s=t-i[e][0];return n===0?0:r===1?s/n:(B(r,s)-1)/(B(r,n)-1)}function $(t,e){return r=>{if(e.length<1)return 0;if(r<=e[0][0])return e[0][1];if(r>=e[e.length-1][0])return e[e.length-1][1];let i=yn(r,e),n=_n(r,i,t,e);return wn(n,e[i][1],e[i+1][1])}}function vn(t,e){return r=>{if(e.length<1)return 0;let i=t;for(let n=0;n<e.length;n++)r>=e[n][0]&&(i=e[n][1]);return i}}function et(t){return $(1,t)}var j=class{constructor(e){var r;this.color=new O(e.color,"black"),this.width=new C(e.width),this.opacity=new C(e.opacity),this.dash=e.dash?new We(e.dash):null,this.dashColor=new O(e.dashColor,"black"),this.dashWidth=new C(e.dashWidth,1),this.lineCap=new O(e.lineCap,"butt"),this.lineJoin=new O(e.lineJoin,"miter"),this.skip=!1,this.perFeature=!!(((r=this.dash)==null?void 0:r.perFeature)||this.color.perFeature||this.opacity.perFeature||this.width.perFeature||this.lineCap.perFeature||this.lineJoin.perFeature||e.perFeature)}before(e,r){this.perFeature||(e.strokeStyle=this.color.get(r),e.lineWidth=this.width.get(r),e.globalAlpha=this.opacity.get(r),e.lineCap=this.lineCap.get(r),e.lineJoin=this.lineJoin.get(r))}draw(e,r,i,n){if(this.skip)return;let s=()=>{this.perFeature&&(e.globalAlpha=this.opacity.get(i,n),e.lineCap=this.lineCap.get(i,n),e.lineJoin=this.lineJoin.get(i,n)),this.dash?(e.save(),this.perFeature?(e.lineWidth=this.dashWidth.get(i,n),e.strokeStyle=this.dashColor.get(i,n),e.setLineDash(this.dash.get(i,n))):e.setLineDash(this.dash.get(i)),e.stroke(),e.restore()):(e.save(),this.perFeature&&(e.lineWidth=this.width.get(i,n),e.strokeStyle=this.color.get(i,n)),e.stroke(),e.restore())};e.beginPath();for(let a of r)for(let o=0;o<a.length;o++){let l=a[o];o===0?e.moveTo(l.x,l.y):e.lineTo(l.x,l.y)}s()}},vt=class{constructor(e){this.name=e.name,this.sheet=e.sheet,this.dpr=window.devicePixelRatio}place(e,r,i){let n=r[0],s=new Z.default(r[0][0].x,r[0][0].y),a=this.sheet.get(this.name),o=a.w/this.dpr,l=a.h/this.dpr,c={minX:s.x-o/2,minY:s.y-l/2,maxX:s.x+o/2,maxY:s.y+l/2};return[{anchor:s,bboxes:[c],draw:d=>{d.globalAlpha=1,d.drawImage(this.sheet.canvas,a.x,a.y,a.w,a.h,-a.w/2/this.dpr,-a.h/2/this.dpr,a.w/2,a.h/2)}}]}},Ae=class{constructor(e){this.radius=new C(e.radius,3),this.fill=new O(e.fill,"black"),this.stroke=new O(e.stroke,"white"),this.width=new C(e.width,0),this.opacity=new C(e.opacity)}draw(e,r,i,n){e.globalAlpha=this.opacity.get(i,n);let s=this.radius.get(i,n),a=this.width.get(i,n);a>0&&(e.strokeStyle=this.stroke.get(i,n),e.lineWidth=a,e.beginPath(),e.arc(r[0][0].x,r[0][0].y,s+a/2,0,2*Math.PI),e.stroke()),e.fillStyle=this.fill.get(i,n),e.beginPath(),e.arc(r[0][0].x,r[0][0].y,s,0,2*Math.PI),e.fill()}place(e,r,i){let n=r[0],s=new Z.default(r[0][0].x,r[0][0].y),a=this.radius.get(e.zoom,i),o={minX:s.x-a,minY:s.y-a,maxX:s.x+a,maxY:s.y+a};return[{anchor:s,bboxes:[o],draw:c=>{this.draw(c,[[new Z.default(0,0)]],e.zoom,i)}}]}},kt=class{constructor(e){this.font=new me(e),this.text=new de(e),this.fill=new O(e.fill,"black"),this.background=new O(e.background,"white"),this.padding=new C(e.padding,0)}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n)return;let s=this.font.get(e.zoom,i);e.scratch.font=s;let a=e.scratch.measureText(n),o=a.width,l=a.actualBoundingBoxAscent,c=a.actualBoundingBoxDescent,f=r[0],d=new Z.default(r[0][0].x,r[0][0].y),p=this.padding.get(e.zoom,i),y={minX:d.x-o/2-p,minY:d.y-l-p,maxX:d.x+o/2+p,maxY:d.y+c+p};return[{anchor:d,bboxes:[y],draw:k=>{k.globalAlpha=1,k.fillStyle=this.background.get(e.zoom,i),k.fillRect(-o/2-p,-l-p,o+2*p,l+c+2*p),k.fillStyle=this.fill.get(e.zoom,i),k.font=s,k.fillText(n,-o/2,0)}}]}},zt=class{constructor(e){this.list=e}place(e,r,i){let n=this.list[0].place(e,r,i);if(!n)return;let s=n[0],a=s.anchor,o=s.bboxes[0],l=o.maxY-o.minY,c=[{draw:s.draw,translate:{x:0,y:0}}],f=[[new Z.default(r[0][0].x,r[0][0].y+l)]];for(let p=1;p<this.list.length;p++)n=this.list[p].place(e,f,i),n&&(s=n[0],o=Lr(o,s.bboxes[0]),c.push({draw:s.draw,translate:{x:0,y:l}}));return[{anchor:a,bboxes:[o],draw:p=>{for(let y of c)p.save(),p.translate(y.translate.x,y.translate.y),y.draw(p),p.restore()}}]}},Lr=(t,e)=>({minX:Math.min(t.minX,e.minX),minY:Math.min(t.minY,e.minY),maxX:Math.max(t.maxX,e.maxX),maxY:Math.max(t.maxY,e.maxY)}),Be=class{constructor(e){this.list=e}place(e,r,i){let n=this.list[0];if(!n)return;let s=n.place(e,r,i);if(!s)return;let a=s[0],o=a.anchor,l=a.bboxes[0],c=[a.draw];for(let d=1;d<this.list.length;d++){if(s=this.list[d].place(e,r,i),!s)return;a=s[0],l=Lr(l,a.bboxes[0]),c.push(a.draw)}return[{anchor:o,bboxes:[l],draw:d=>{for(let p of c)p(d)}}]}},Ge=class{constructor(e){this.symbolizer=e}place(e,r,i){let n=r[0][0],s=this.symbolizer.place(e,[[new Z.default(0,0)]],i);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=o.maxX-o.minX,c=o.maxY-o.minY,f={minX:n.x-l/2,maxX:n.x+l/2,minY:n.y-c/2,maxY:n.y+c/2};return[{anchor:n,bboxes:[f],draw:p=>{p.translate(-l/2,c/2-o.maxY),a.draw(p,{justify:2})}}]}},Tt=class{constructor(e,r){this.padding=new C(e,0),this.symbolizer=r}place(e,r,i){let n=this.symbolizer.place(e,r,i);if(!n||n.length===0)return;let s=this.padding.get(e.zoom,i);for(let a of n)for(let o of a.bboxes)o.minX-=s,o.minY-=s,o.maxX+=s,o.maxY+=s;return n}},Re=class{constructor(e){this.font=new me(e),this.text=new de(e),this.fill=new O(e.fill,"black"),this.stroke=new O(e.stroke,"black"),this.width=new C(e.width,0),this.lineHeight=new C(e.lineHeight,1),this.letterSpacing=new C(e.letterSpacing,0),this.maxLineCodeUnits=new C(e.maxLineChars,15),this.justify=e.justify}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n)return;let s=this.font.get(e.zoom,i);e.scratch.font=s;let a=this.letterSpacing.get(e.zoom,i),o=ft(n,this.maxLineCodeUnits.get(e.zoom,i)),l="",c=0;for(let m of o)m.length>c&&(c=m.length,l=m);let f=e.scratch.measureText(l),d=f.width+a*(c-1),p=f.actualBoundingBoxAscent,y=f.actualBoundingBoxDescent,_=(p+y)*this.lineHeight.get(e.zoom,i),k=new Z.default(r[0][0].x,r[0][0].y),u={minX:k.x,minY:k.y-p,maxX:k.x+d,maxY:k.y+y+(o.length-1)*_};return[{anchor:k,bboxes:[u],draw:(m,x)=>{m.globalAlpha=1,m.font=s,m.fillStyle=this.fill.get(e.zoom,i);let g=this.width.get(e.zoom,i),b=0;for(let v of o){let w=0;if(this.justify===2||x&&x.justify===2?w=(d-m.measureText(v).width)/2:(this.justify===3||x&&x.justify===3)&&(w=d-m.measureText(v).width),g)if(m.lineWidth=g*2,m.strokeStyle=this.stroke.get(e.zoom,i),a>0){let z=w;for(let T of v)m.strokeText(T,z,b),z+=m.measureText(T).width+a}else m.strokeText(v,w,b);if(a>0){let z=w;for(let T of v)m.fillText(T,z,b),z+=m.measureText(T).width+a}else m.fillText(v,w,b);b+=_}}}]}},re=class{constructor(e){this.centered=new Ge(new Re(e))}place(e,r,i){return this.centered.place(e,r,i)}},Qe=class{constructor(e,r){var i,n,s;this.symbolizer=e,this.offsetX=new C(r.offsetX,0),this.offsetY=new C(r.offsetY,0),this.justify=(i=r.justify)!=null?i:void 0,this.placements=(n=r.placements)!=null?n:[2,6,8,4,1,3,5,7],this.ddValues=(s=r.ddValues)!=null?s:()=>({})}place(e,r,i){if(i.geomType!==1)return;let n=r[0][0],s=this.symbolizer.place(e,[[new Z.default(0,0)]],i);if(!s||s.length===0)return;let a=s[0],o=a.bboxes[0],l=this.offsetX,c=this.offsetY,f=this.justify,d=this.placements,{offsetX:p,offsetY:y,justify:_,placements:k}=this.ddValues(e.zoom,i)||{};p&&(l=new C(p,0)),y&&(c=new C(y,0)),_&&(f=_),k&&(d=k);let u=l.get(e.zoom,i),h=c.get(e.zoom,i),m=(w,z)=>({minX:w.x+z.x+o.minX,minY:w.y+z.y+o.minY,maxX:w.x+z.x+o.maxX,maxY:w.y+z.y+o.maxY}),x=new Z.default(u,h),g,b=w=>{w.translate(x.x,x.y),a.draw(w,{justify:g})},v=(w,z)=>{let T=m(w,z);if(!e.index.bboxCollides(T,e.order))return[{anchor:n,bboxes:[T],draw:b}]};for(let w of d){let z=this.computeXaxisOffset(u,o,w),T=this.computeYaxisOffset(h,o,w);return g=this.computeJustify(f,w),x=new Z.default(z,T),v(n,x)}}computeXaxisOffset(e,r,i){let n=r.maxX,s=n/2;return[1,5].includes(i)?e-s:[8,7,6].includes(i)?e-n:e}computeYaxisOffset(e,r,i){let n=Math.abs(r.minY),s=r.maxY,a=(r.minY+r.maxY)/2;return[3,7].includes(i)?e-a:[8,2,1].includes(i)?e-s:[6,4,5].includes(i)?e+n:e}computeJustify(e,r){return e||([1,5].includes(r)?2:[2,3,4].includes(r)?1:3)}},Oe=class{constructor(e){this.symbolizer=new Qe(new Re(e),e)}place(e,r,i){return this.symbolizer.place(e,r,i)}},Sr=(i=>(i[i.Above=1]="Above",i[i.Center=2]="Center",i[i.Below=3]="Below",i))(Sr||{}),le=class{constructor(e){var r;this.font=new me(e),this.text=new de(e),this.fill=new O(e.fill,"black"),this.stroke=new O(e.stroke,"black"),this.width=new C(e.width,0),this.offset=new C(e.offset,0),this.position=(r=e.position)!=null?r:1,this.maxLabelCodeUnits=new C(e.maxLabelChars,40),this.repeatDistance=new C(e.repeatDistance,250)}place(e,r,i){let n=this.text.get(e.zoom,i);if(!n||n.length>this.maxLabelCodeUnits.get(e.zoom,i))return;let s=20,a=i.bbox;if(a.maxY-a.minY<s&&a.maxX-a.minX<s)return;let o=this.font.get(e.zoom,i);e.scratch.font=o;let l=e.scratch.measureText(n),c=l.width,f=l.actualBoundingBoxAscent+l.actualBoundingBoxDescent,d=this.repeatDistance.get(e.zoom,i);e.overzoom>4&&(d*=1<<e.overzoom-4);let p=f*2,y=Et(r,c,d,p);if(y.length===0)return;let _=[];for(let k of y){let u=k.end.x-k.start.x,h=k.end.y-k.start.y,x=Ut(k.start,k.end,c,p/2).map(b=>({minX:b.x-p/2,minY:b.y-p/2,maxX:b.x+p/2,maxY:b.y+p/2})),g=b=>{b.globalAlpha=1,b.rotate(Math.atan2(h,u)),u<0&&(b.scale(-1,-1),b.translate(-c,0));let v=0;this.position===3?v+=f:this.position===2&&(v+=f/2),b.translate(0,v-this.offset.get(e.zoom,i)),b.font=o;let w=this.width.get(e.zoom,i);w&&(b.lineWidth=w,b.strokeStyle=this.stroke.get(e.zoom,i),b.strokeText(n,0,0)),b.fillStyle=this.fill.get(e.zoom,i),b.fillText(n,0,0)};_.push({anchor:k.start,bboxes:x,draw:g,deduplicationKey:n,deduplicationDistance:d})}return _}};var H=(t,e)=>{let r=t[e];return typeof r=="string"?r:""},Fr=(t,e)=>{let r=t[e];return typeof r=="number"?r:0},je=t=>[{dataLayer:"earth",symbolizer:new D({fill:t.earth})},{dataLayer:"landuse",symbolizer:new D({fill:(e,r)=>Ne(t.park_a,t.park_b,Math.min(Math.max(e/12,12),0))}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["allotments","village_green","playground"].includes(i)}},{dataLayer:"landuse",symbolizer:new D({fill:t.park_b,opacity:.7}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["national_park","park","cemetery","protected_area","nature_reserve","forest","golf_course"].includes(i)}},{dataLayer:"landuse",symbolizer:new D({fill:t.hospital}),filter:(e,r)=>r.props["pmap:kind"]==="hospital"},{dataLayer:"landuse",symbolizer:new D({fill:t.industrial}),filter:(e,r)=>r.props["pmap:kind"]==="industrial"},{dataLayer:"landuse",symbolizer:new D({fill:t.school}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["school","university","college"].includes(i)}},{dataLayer:"landuse",symbolizer:new D({fill:t.beach}),filter:(e,r)=>r.props["pmap:kind"]==="beach"},{dataLayer:"landuse",symbolizer:new D({fill:t.zoo}),filter:(e,r)=>r.props["pmap:kind"]==="zoo"},{dataLayer:"landuse",symbolizer:new D({fill:t.zoo}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["military","naval_base","airfield"].includes(i)}},{dataLayer:"natural",symbolizer:new D({fill:(e,r)=>Ne(t.wood_a,t.wood_b,Math.min(Math.max(e/12,12),0))}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["wood","nature_reserve","forest"].includes(i)}},{dataLayer:"natural",symbolizer:new D({fill:(e,r)=>Ne(t.scrub_a,t.scrub_b,Math.min(Math.max(e/12,12),0))}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new D({fill:t.scrub_b}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["scrub","grassland","grass"].includes(i)}},{dataLayer:"natural",symbolizer:new D({fill:t.glacier}),filter:(e,r)=>r.props["pmap:kind"]==="glacier"},{dataLayer:"natural",symbolizer:new D({fill:t.sand}),filter:(e,r)=>r.props["pmap:kind"]==="sand"},{dataLayer:"landuse",symbolizer:new D({fill:t.aerodrome}),filter:(e,r)=>r.props["pmap:kind"]==="aerodrome"},{dataLayer:"water",symbolizer:new D({fill:t.water})},{dataLayer:"transit",symbolizer:new j({color:t.runway,width:(e,r)=>$(1.6,[[11,0],[13,4],[19,30]])(e)}),filter:(e,r)=>r.props["pmap:kind_detail"]==="runway"},{dataLayer:"transit",symbolizer:new j({color:t.runway,width:(e,r)=>$(1.6,[[14,0],[14.5,1],[16,6]])(e)}),filter:(e,r)=>r.props["pmap:kind_detail"]==="taxiway"},{dataLayer:"transit",symbolizer:new j({color:t.pier,width:(e,r)=>$(1.6,[[13,0],[13.5,0,5],[21,16]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="pier"},{dataLayer:"physical_line",minzoom:14,symbolizer:new j({color:t.water,width:(e,r)=>$(1.6,[[9,0],[9.5,1],[18,12]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="river"},{dataLayer:"physical_line",minzoom:14,symbolizer:new j({color:t.water,width:.5}),filter:(e,r)=>r.props["pmap:kind"]==="stream"},{dataLayer:"landuse",symbolizer:new D({fill:t.pedestrian}),filter:(e,r)=>r.props["pmap:kind"]==="pedestrian"},{dataLayer:"landuse",symbolizer:new D({fill:t.pier}),filter:(e,r)=>r.props["pmap:kind"]==="pier"},{dataLayer:"buildings",symbolizer:new D({fill:t.buildings,opacity:.5})},{dataLayer:"roads",symbolizer:new j({color:t.major,width:(e,r)=>$(1.6,[[14,0],[20,7]])(e)}),filter:(e,r)=>{let i=H(r.props,"pmap:kind");return["other","path"].includes(i)}},{dataLayer:"roads",symbolizer:new j({color:t.major,width:(e,r)=>$(1.6,[[13,0],[18,8]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="minor_road"},{dataLayer:"roads",symbolizer:new j({color:t.major,width:(e,r)=>$(1.6,[[7,0],[12,1.2],[15,3],[18,13]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="medium_road"},{dataLayer:"roads",symbolizer:new j({color:t.major,width:(e,r)=>$(1.6,[[6,0],[12,1.6],[15,3],[18,13]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="major_road"},{dataLayer:"roads",symbolizer:new j({color:t.major,width:(e,r)=>$(1.6,[[3,0],[6,1.1],[12,1.6],[15,5],[18,15]])(e)}),filter:(e,r)=>r.props["pmap:kind"]==="highway"},{dataLayer:"boundaries",symbolizer:new j({dash:[3,2],color:t.boundaries,width:1}),filter:(e,r)=>{let i=r.props["pmap:min_admin_level"];return typeof i=="number"&&i<=2}},{dataLayer:"transit",symbolizer:new j({dash:[.3,.75],color:t.railway,dashWidth:(e,r)=>$(1.6,[[4,0],[7,.15],[19,9]])(e),opacity:.5}),filter:(e,r)=>r.props["pmap:kind"]==="rail"},{dataLayer:"boundaries",symbolizer:new j({dash:[3,2],color:t.boundaries,width:.5}),filter:(e,r)=>{let i=r.props["pmap:min_admin_level"];return typeof i=="number"&&i>2}}],Xe=t=>{let e=["name"];return[{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:t.roads_label_minor,font:"400 12px sans-serif",width:2,stroke:t.roads_label_minor_halo}),minzoom:16,filter:(r,i)=>{let n=H(i.props,"pmap:kind");return["minor_road","other","path"].includes(n)}},{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:(r,i)=>{let n=H(i.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"roads",symbolizer:new le({labelProps:e,fill:t.roads_label_major,font:"400 12px sans-serif",width:2,stroke:t.roads_label_major_halo}),minzoom:12,filter:(r,i)=>{let n=H(i.props,"pmap:kind");return["highway","major_road","medium_road"].includes(n)}},{dataLayer:"physical_point",symbolizer:new re({labelProps:e,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:(r,i)=>`400 ${et([[3,10],[10,12]])(r)}px sans-serif`,textTransform:"uppercase"}),filter:(r,i)=>{let n=H(i.props,"pmap:kind");return["ocean","bay","strait","fjord"].includes(n)}},{dataLayer:"physical_point",symbolizer:new re({labelProps:e,fill:t.ocean_label,lineHeight:1.5,letterSpacing:1,font:(r,i)=>`400 ${et([[3,0],[6,12],[10,12]])(r)}px sans-serif`}),filter:(r,i)=>{let n=H(i.props,"pmap:kind");return["sea","lake","water"].includes(n)}},{dataLayer:"places",symbolizer:new re({labelProps:(r,i)=>r<6?["name:short"]:e,fill:t.state_label,stroke:t.state_label_halo,width:1,lineHeight:1.5,font:(r,i)=>r<6?"400 16px sans-serif":"400 12px sans-serif",textTransform:"uppercase"}),filter:(r,i)=>i.props["pmap:kind"]==="region"},{dataLayer:"places",symbolizer:new re({labelProps:e,fill:t.country_label,lineHeight:1.5,font:(r,i)=>(r<6,"600 12px sans-serif"),textTransform:"uppercase"}),filter:(r,i)=>i.props["pmap:kind"]==="country"},{dataLayer:"places",minzoom:9,symbolizer:new re({labelProps:e,fill:t.city_label,lineHeight:1.5,font:(r,i)=>{if(!i)return"400 12px sans-serif";let n=i.props["pmap:min_zoom"],s=400;n&&n<=5&&(s=600);let a=12,o=i.props["pmap:population_rank"];return o&&o>9&&(a=16),`${s} ${a}px sans-serif`}}),sort:(r,i)=>{let n=Fr(r,"pmap:population_rank"),s=Fr(i,"pmap:population_rank");return n-s},filter:(r,i)=>i.props["pmap:kind"]==="locality"},{dataLayer:"places",maxzoom:8,symbolizer:new Be([new Ae({radius:2,fill:t.city_circle,stroke:t.city_circle_stroke,width:1.5}),new Oe({labelProps:e,fill:t.city_label,stroke:t.city_label_halo,width:1,offsetX:6,offsetY:4.5,font:(r,i)=>"400 12px sans-serif"})]),filter:(r,i)=>i.props["pmap:kind"]==="locality"}]};var kn={background:"#cccccc",earth:"#e0e0e0",park_a:"#cfddd5",park_b:"#9cd3b4",hospital:"#e4dad9",industrial:"#d1dde1",school:"#e4ded7",wood_a:"#d0ded0",wood_b:"#a0d9a0",pedestrian:"#e3e0d4",scrub_a:"#cedcd7",scrub_b:"#99d2bb",glacier:"#e7e7e7",sand:"#e2e0d7",beach:"#e8e4d0",aerodrome:"#dadbdf",runway:"#e9e9ed",water:"#80deea",pier:"#e0e0e0",zoo:"#c6dcdc",military:"#dcdcdc",tunnel_other_casing:"#e0e0e0",tunnel_minor_casing:"#e0e0e0",tunnel_link_casing:"#e0e0e0",tunnel_medium_casing:"#e0e0e0",tunnel_major_casing:"#e0e0e0",tunnel_highway_casing:"#e0e0e0",tunnel_other:"#d5d5d5",tunnel_minor:"#d5d5d5",tunnel_link:"#d5d5d5",tunnel_medium:"#d5d5d5",tunnel_major:"#d5d5d5",tunnel_highway:"#d5d5d5",transit_pier:"#e0e0e0",buildings:"#cccccc",minor_service_casing:"#e0e0e0",minor_casing:"#e0e0e0",link_casing:"#e0e0e0",medium_casing:"#e0e0e0",major_casing_late:"#e0e0e0",highway_casing_late:"#e0e0e0",other:"#ebebeb",minor_service:"#ebebeb",minor_a:"#ebebeb",minor_b:"#ffffff",link:"#ffffff",medium:"#f5f5f5",major_casing_early:"#e0e0e0",major:"#ffffff",highway_casing_early:"#e0e0e0",highway:"#ffffff",railway:"#a7b1b3",boundaries:"#adadad",waterway_label:"#ffffff",bridges_other_casing:"#e0e0e0",bridges_minor_casing:"#e0e0e0",bridges_link_casing:"#e0e0e0",bridges_medium_casing:"#e0e0e0",bridges_major_casing:"#e0e0e0",bridges_highway_casing:"#e0e0e0",bridges_other:"#ebebeb",bridges_minor:"#ffffff",bridges_link:"#ffffff",bridges_medium:"#f0eded",bridges_major:"#f5f5f5",bridges_highway:"#ffffff",roads_label_minor:"#91888b",roads_label_minor_halo:"#ffffff",roads_label_major:"#938a8d",roads_label_major_halo:"#ffffff",ocean_label:"#ffffff",peak_label:"#7e9aa0",subplace_label:"#8f8f8f",subplace_label_halo:"#e0e0e0",city_circle:"#ffffff",city_circle_stroke:"#a3a3a3",city_label:"#5c5c5c",city_label_halo:"#e0e0e0",state_label:"#b3b3b3",state_label_halo:"#e0e0e0",country_label:"#a3a3a3"},zn={background:"#34373d",earth:"#1f1f1f",park_a:"#232325",park_b:"#232325",hospital:"#252424",industrial:"#222222",school:"#262323",wood_a:"#202121",wood_b:"#202121",pedestrian:"#1e1e1e",scrub_a:"#222323",scrub_b:"#222323",glacier:"#1c1c1c",sand:"#212123",beach:"#28282a",aerodrome:"#1e1e1e",runway:"#333333",water:"#34373d",pier:"#222222",zoo:"#222323",military:"#242323",tunnel_other_casing:"#141414",tunnel_minor_casing:"#141414",tunnel_link_casing:"#141414",tunnel_medium_casing:"#141414",tunnel_major_casing:"#141414",tunnel_highway_casing:"#141414",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#333333",buildings:"#111111",minor_service_casing:"#1f1f1f",minor_casing:"#1f1f1f",link_casing:"#1f1f1f",medium_casing:"#1f1f1f",major_casing_late:"#1f1f1f",highway_casing_late:"#1f1f1f",other:"#333333",minor_service:"#333333",minor_a:"#3d3d3d",minor_b:"#333333",link:"#3d3d3d",medium:"#3d3d3d",major_casing_early:"#1f1f1f",major:"#3d3d3d",highway_casing_early:"#1f1f1f",highway:"#474747",railway:"#000000",boundaries:"#5b6374",waterway_label:"#717784",bridges_other_casing:"#2b2b2b",bridges_minor_casing:"#1f1f1f",bridges_link_casing:"#1f1f1f",bridges_medium_casing:"#1f1f1f",bridges_major_casing:"#1f1f1f",bridges_highway_casing:"#1f1f1f",bridges_other:"#333333",bridges_minor:"#333333",bridges_link:"#3d3d3d",bridges_medium:"#3d3d3d",bridges_major:"#3d3d3d",bridges_highway:"#474747",roads_label_minor:"#525252",roads_label_minor_halo:"#1f1f1f",roads_label_major:"#666666",roads_label_major_halo:"#1f1f1f",ocean_label:"#717784",peak_label:"#898080",subplace_label:"#525252",subplace_label_halo:"#1f1f1f",city_circle:"#000000",city_circle_stroke:"#7a7a7a",city_label:"#7a7a7a",city_label_halo:"#212121",state_label:"#3d3d3d",state_label_halo:"#1f1f1f",country_label:"#5c5c5c"},Tn={background:"#ffffff",earth:"#ffffff",park_a:"#fcfcfc",park_b:"#fcfcfc",hospital:"#f8f8f8",industrial:"#fcfcfc",school:"#f8f8f8",wood_a:"#fafafa",wood_b:"#fafafa",pedestrian:"#fdfdfd",scrub_a:"#fafafa",scrub_b:"#fafafa",glacier:"#fcfcfc",sand:"#fafafa",beach:"#f6f6f6",aerodrome:"#fdfdfd",runway:"#efefef",water:"#dcdcdc",pier:"#f5f5f5",zoo:"#f7f7f7",military:"#fcfcfc",tunnel_other_casing:"#d6d6d6",tunnel_minor_casing:"#fcfcfc",tunnel_link_casing:"#fcfcfc",tunnel_medium_casing:"#fcfcfc",tunnel_major_casing:"#fcfcfc",tunnel_highway_casing:"#fcfcfc",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#efefef",buildings:"#efefef",minor_service_casing:"#ffffff",minor_casing:"#ffffff",link_casing:"#ffffff",medium_casing:"#ffffff",major_casing_late:"#ffffff",highway_casing_late:"#ffffff",other:"#f5f5f5",minor_service:"#f5f5f5",minor_a:"#ebebeb",minor_b:"#f5f5f5",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#ffffff",major:"#ebebeb",highway_casing_early:"#ffffff",highway:"#ebebeb",railway:"#d6d6d6",boundaries:"#adadad",waterway_label:"#adadad",bridges_other_casing:"#ffffff",bridges_minor_casing:"#ffffff",bridges_link_casing:"#ffffff",bridges_medium_casing:"#ffffff",bridges_major_casing:"#ffffff",bridges_highway_casing:"#ffffff",bridges_other:"#f5f5f5",bridges_minor:"#f5f5f5",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#adadad",roads_label_minor_halo:"#ffffff",roads_label_major:"#999999",roads_label_major_halo:"#ffffff",ocean_label:"#adadad",peak_label:"#adadad",subplace_label:"#8f8f8f",subplace_label_halo:"#ffffff",city_circle:"#ffffff",city_circle_stroke:"#adadad",city_label:"#5c5c5c",city_label_halo:"#ffffff",state_label:"#b3b3b3",state_label_halo:"#ffffff",country_label:"#b8b8b8"},Ln={background:"#a3a3a3",earth:"#cccccc",park_a:"#c2c2c2",park_b:"#c2c2c2",hospital:"#d0d0d0",industrial:"#c6c6c6",school:"#d0d0d0",wood_a:"#c2c2c2",wood_b:"#c2c2c2",pedestrian:"#c4c4c4",scrub_a:"#c2c2c2",scrub_b:"#c2c2c2",glacier:"#d2d2d2",sand:"#d2d2d2",beach:"#d2d2d2",aerodrome:"#c9c9c9",runway:"#f5f5f5",water:"#a3a3a3",pier:"#b8b8b8",zoo:"#c7c7c7",military:"#bfbfbf",tunnel_other_casing:"#b8b8b8",tunnel_minor_casing:"#b8b8b8",tunnel_link_casing:"#b8b8b8",tunnel_medium_casing:"#b8b8b8",tunnel_major_casing:"#b8b8b8",tunnel_highway_casing:"#b8b8b8",tunnel_other:"#d6d6d6",tunnel_minor:"#d6d6d6",tunnel_link:"#d6d6d6",tunnel_medium:"#d6d6d6",tunnel_major:"#d6d6d6",tunnel_highway:"#d6d6d6",transit_pier:"#b8b8b8",buildings:"#e0e0e0",minor_service_casing:"#cccccc",minor_casing:"#cccccc",link_casing:"#cccccc",medium_casing:"#cccccc",major_casing_late:"#cccccc",highway_casing_late:"#cccccc",other:"#e0e0e0",minor_service:"#e0e0e0",minor_a:"#ebebeb",minor_b:"#e0e0e0",link:"#ebebeb",medium:"#ebebeb",major_casing_early:"#cccccc",major:"#ebebeb",highway_casing_early:"#cccccc",highway:"#ebebeb",railway:"#f5f5f5",boundaries:"#5c5c5c",waterway_label:"#7a7a7a",bridges_other_casing:"#cccccc",bridges_minor_casing:"#cccccc",bridges_link_casing:"#cccccc",bridges_medium_casing:"#cccccc",bridges_major_casing:"#cccccc",bridges_highway_casing:"#cccccc",bridges_other:"#e0e0e0",bridges_minor:"#e0e0e0",bridges_link:"#ebebeb",bridges_medium:"#ebebeb",bridges_major:"#ebebeb",bridges_highway:"#ebebeb",roads_label_minor:"#999999",roads_label_minor_halo:"#e0e0e0",roads_label_major:"#8f8f8f",roads_label_major_halo:"#ebebeb",ocean_label:"#7a7a7a",peak_label:"#5c5c5c",subplace_label:"#7a7a7a",subplace_label_halo:"#cccccc",city_circle:"#c2c2c2",city_circle_stroke:"#7a7a7a",city_label:"#474747",city_label_halo:"#cccccc",state_label:"#999999",state_label_halo:"#cccccc",country_label:"#858585"},Sn={background:"#2b2b2b",earth:"#141414",park_a:"#181818",park_b:"#181818",hospital:"#1d1d1d",industrial:"#101010",school:"#111111",wood_a:"#1a1a1a",wood_b:"#1a1a1a",pedestrian:"#191919",scrub_a:"#1c1c1c",scrub_b:"#1c1c1c",glacier:"#191919",sand:"#161616",beach:"#1f1f1f",aerodrome:"#191919",runway:"#323232",water:"#333333",pier:"#0a0a0a",zoo:"#191919",military:"#121212",tunnel_other_casing:"#101010",tunnel_minor_casing:"#101010",tunnel_link_casing:"#101010",tunnel_medium_casing:"#101010",tunnel_major_casing:"#101010",tunnel_highway_casing:"#101010",tunnel_other:"#292929",tunnel_minor:"#292929",tunnel_link:"#292929",tunnel_medium:"#292929",tunnel_major:"#292929",tunnel_highway:"#292929",transit_pier:"#0a0a0a",buildings:"#0a0a0a",minor_service_casing:"#141414",minor_casing:"#141414",link_casing:"#141414",medium_casing:"#141414",major_casing_late:"#141414",highway_casing_late:"#141414",other:"#1f1f1f",minor_service:"#1f1f1f",minor_a:"#292929",minor_b:"#1f1f1f",link:"#1f1f1f",medium:"#292929",major_casing_early:"#141414",major:"#292929",highway_casing_early:"#141414",highway:"#292929",railway:"#292929",boundaries:"#707070",waterway_label:"#707070",bridges_other_casing:"#141414",bridges_minor_casing:"#141414",bridges_link_casing:"#141414",bridges_medium_casing:"#141414",bridges_major_casing:"#141414",bridges_highway_casing:"#141414",bridges_other:"#1f1f1f",bridges_minor:"#1f1f1f",bridges_link:"#292929",bridges_medium:"#292929",bridges_major:"#292929",bridges_highway:"#292929",roads_label_minor:"#525252",roads_label_minor_halo:"#141414",roads_label_major:"#5c5c5c",roads_label_major_halo:"#141414",ocean_label:"#707070",peak_label:"#707070",subplace_label:"#5c5c5c",subplace_label_halo:"#141414",city_circle:"#000000",city_circle_stroke:"#666666",city_label:"#999999",city_label_halo:"#141414",state_label:"#3d3d3d",state_label_halo:"#141414",country_label:"#707070"},Fn={light:kn,dark:zn,white:Tn,grayscale:Ln,black:Sn},tt=Fn;var Pr=J(Q(),1),Cr=J(Mr(),1);var ce=J(Q(),1);var Ye=(t,e,r)=>{let i=[];for(let n of t){let s=[];for(let a of n)s.push(a.clone().mult(e).add(r));i.push(s)}return i},Ve=(t,e)=>{let r=1<<e;return t<0?r+t:t>=r?t%r:t},rt=class{constructor(e,r,i){this.tileCache=e,this.maxDataLevel=r,this.levelDiff=i}dataTilesForBounds(e,r){let i=B(2,e)/B(2,Math.ceil(e)),n=[],s=1,a=this.tileCache.tileSize;if(e<this.levelDiff)s=1/(1<<this.levelDiff-e)*i,n.push({dataTile:{z:0,x:0,y:0},origin:new ce.default(0,0),scale:s,dim:a*s});else if(e<=this.levelDiff+this.maxDataLevel){let o=1<<this.levelDiff,l=256*i,c=Math.ceil(e)-this.levelDiff,f=Math.floor(r.minX/o/l),d=Math.floor(r.minY/o/l),p=Math.floor(r.maxX/o/l),y=Math.floor(r.maxY/o/l);for(let _=f;_<=p;_++)for(let k=d;k<=y;k++){let u=new ce.default(_*o*l,k*o*l);n.push({dataTile:{z:c,x:Ve(_,c),y:Ve(k,c)},origin:u,scale:i,dim:a*i})}}else{let o=1<<this.levelDiff;s=(1<<Math.ceil(e)-this.maxDataLevel-this.levelDiff)*i;let l=Math.floor(r.minX/o/256/s),c=Math.floor(r.minY/o/256/s),f=Math.floor(r.maxX/o/256/s),d=Math.floor(r.maxY/o/256/s);for(let p=l;p<=f;p++)for(let y=c;y<=d;y++){let _=new ce.default(p*o*256*s,y*o*256*s);n.push({dataTile:{z:this.maxDataLevel,x:Ve(p,this.maxDataLevel),y:Ve(y,this.maxDataLevel)},origin:_,scale:s,dim:a*s})}}return n}dataTileForDisplayTile(e){let r,i=1,n=this.tileCache.tileSize,s;if(e.z<this.levelDiff)r={z:0,x:0,y:0},i=1/(1<<this.levelDiff-e.z),s=new ce.default(0,0),n=n*i;else if(e.z<=this.levelDiff+this.maxDataLevel){let a=1<<this.levelDiff;r={z:e.z-this.levelDiff,x:Math.floor(e.x/a),y:Math.floor(e.y/a)},s=new ce.default(r.x*a*256,r.y*a*256)}else{i=1<<e.z-this.maxDataLevel-this.levelDiff;let a=1<<this.levelDiff;r={z:this.maxDataLevel,x:Math.floor(e.x/a/i),y:Math.floor(e.y/a/i)},s=new ce.default(r.x*a*i*256,r.y*a*i*256),n=n*i}return{dataTile:r,scale:i,origin:s,dim:n}}getBbox(e,r){return R(this,null,function*(){let i=this.dataTilesForBounds(e,r);return(yield Promise.all(i.map(s=>this.tileCache.get(s.dataTile)))).map((s,a)=>{let o=i[a];return{data:s,z:e,dataTile:o.dataTile,scale:o.scale,dim:o.dim,origin:o.origin}})})}getDisplayTile(e){return R(this,null,function*(){let r=this.dataTileForDisplayTile(e);return{data:yield this.tileCache.get(r.dataTile),z:e.z,dataTile:r.dataTile,scale:r.scale,origin:r.origin,dim:r.dim}})}},Ie=t=>{let e=i=>{let n=i.levelDiff===void 0?1:i.levelDiff,s=i.maxDataZoom||15,a;if(typeof i.url=="string")i.url.endsWith(".pmtiles")?a=new _e(i.url,!0):a=new Ce(i.url,!0);else if(i.url)a=new _e(i.url,!0);else throw new Error(`Invalid source ${i.url}`);let o=new De(a,256*1<<n);return new rt(o,s,n)},r=new Map;if(t.sources)for(let i in t.sources)r.set(i,e(t.sources[i]));else r.set("",e(t));return r};var Dr=(t,e,r)=>{let n=e/256,s=Math.floor(r.minX/256),a=Math.floor(r.minY/256),o=Math.floor(r.maxX/256),l=Math.floor(r.maxY/256),c=Math.log2(n),f=[];for(let d=s;d<=o;d++){let p=d%(1<<t);for(let y=a;y<=l;y++)f.push({display:se({z:t,x:p,y}),key:se({z:t-c,x:Math.floor(p/n),y:Math.floor(y/n)})})}return f},it=class{constructor(e,r){this.tree=new Cr.default,this.current=new Map,this.dim=e,this.maxLabeledTiles=r}hasPrefix(e){for(let r of this.current.keys())if(r.startsWith(e))return!0;return!1}has(e){return this.current.has(e)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(e,r){let i=new Set;for(let n of this.tree.search(e))n.indexedLabel.order<=r&&i.add(n.indexedLabel);return i}searchLabel(e,r){let i=new Set;for(let n of e.bboxes)for(let s of this.tree.search(n))s.indexedLabel.order<=r&&i.add(s.indexedLabel);return i}bboxCollides(e,r){for(let i of this.tree.search(e))if(i.indexedLabel.order<=r)return!0;return!1}labelCollides(e,r){for(let i of e.bboxes)for(let n of this.tree.search(i))if(n.indexedLabel.order<=r)return!0;return!1}deduplicationCollides(e){if(!e.deduplicationKey||!e.deduplicationDistance)return!1;let r=e.deduplicationDistance,i={minX:e.anchor.x-r,minY:e.anchor.y-r,maxX:e.anchor.x+r,maxY:e.anchor.y+r};for(let n of this.tree.search(i))if(n.indexedLabel.deduplicationKey===e.deduplicationKey&&n.indexedLabel.anchor.dist(e.anchor)<r)return!0;return!1}makeEntry(e){this.current.get(e)&&console.log("consistency error 1");let r=new Set;this.current.set(e,r)}insert(e,r,i){let n={anchor:e.anchor,bboxes:e.bboxes,draw:e.draw,order:r,tileKey:i,deduplicationKey:e.deduplicationKey,deduplicationDistance:e.deduplicationDistance},s=this.current.get(i);if(!s){let l=new Set;this.current.set(i,l),s=l}s.add(n);let a=!1,o=!1;for(let l of e.bboxes)this.tree.insert({minX:l.minX,minY:l.minY,maxX:l.maxX,maxY:l.maxY,indexedLabel:n}),l.minX<0&&(a=!0),l.maxX>this.dim&&(o=!0);if(a||o){let l=a?this.dim:-this.dim,c=[];for(let p of e.bboxes)c.push({minX:p.minX+l,minY:p.minY,maxX:p.maxX+l,maxY:p.maxY});let f={anchor:new Pr.default(e.anchor.x+l,e.anchor.y),bboxes:c,draw:e.draw,order:r,tileKey:i},d=this.current.get(i);d&&d.add(f);for(let p of c)this.tree.insert({minX:p.minX,minY:p.minY,maxX:p.maxX,maxY:p.maxY,indexedLabel:f})}}pruneOrNoop(e){let r=e.split(":"),i,n=0,s=0;for(let a of this.current.keys()){let o=a.split(":");if(o[3]===r[3]){s++;let l=Math.sqrt(B(+o[0]-+r[0],2)+B(+o[1]-+r[1],2));l>n&&(n=l,i=a)}i&&s>this.maxLabeledTiles&&this.pruneKey(i)}}pruneKey(e){let r=this.current.get(e);if(!r)return;let i=[];for(let n of this.tree.all())r.has(n.indexedLabel)&&i.push(n);for(let n of i)this.tree.remove(n);this.current.delete(e)}removeLabel(e){let r=[];for(let n of this.tree.all())e===n.indexedLabel&&r.push(n);for(let n of r)this.tree.remove(n);let i=this.current.get(e.tileKey);i&&i.delete(e)}},ve=class{constructor(e,r,i,n,s){this.index=new it(256*1<<e,n),this.z=e,this.scratch=r,this.labelRules=i,this.callback=s}layout(e){let r=performance.now(),i=new Set;for(let[s,a]of e)for(let o of a){let l=`${se(o.dataTile)}:${s}`;this.index.has(l)||(this.index.makeEntry(l),i.add(l))}let n=new Set;for(let[s,a]of this.labelRules.entries()){if(a.visible===!1||a.minzoom&&this.z<a.minzoom||a.maxzoom&&this.z>a.maxzoom)continue;let o=a.dataSource||"",l=e.get(o);if(!!l)for(let c of l){let f=`${se(c.dataTile)}:${o}`;if(!i.has(f))continue;let d=c.data.get(a.dataLayer);if(d===void 0)continue;let p=d;a.sort&&p.sort((_,k)=>a.sort?a.sort(_.props,k.props):0);let y={index:this.index,zoom:this.z,scratch:this.scratch,order:s,overzoom:this.z-c.dataTile.z};for(let _ of p){if(a.filter&&!a.filter(this.z,_))continue;let k=Ye(_.geom,c.scale,c.origin),u=a.symbolizer.place(y,k,_);if(!!u)for(let h of u){let m=!1;if(!(h.deduplicationKey&&this.index.deduplicationCollides(h))){if(this.index.labelCollides(h,1/0)){if(!this.index.labelCollides(h,s)){let x=this.index.searchLabel(h,1/0);for(let g of x){this.index.removeLabel(g);for(let b of g.bboxes)this.findInvalidatedTiles(n,c.dim,b,f)}this.index.insert(h,s,f),m=!0}}else this.index.insert(h,s,f),m=!0;if(m)for(let x of h.bboxes)(x.maxX>c.origin.x+c.dim||x.minX<c.origin.x||x.minY<c.origin.y||x.maxY>c.origin.y+c.dim)&&this.findInvalidatedTiles(n,c.dim,x,f)}}}}}for(let s of i)this.index.pruneOrNoop(s);return n.size>0&&this.callback&&this.callback(n),performance.now()-r}findInvalidatedTiles(e,r,i,n){let s=Dr(this.z,r,i);for(let a of s)a.key!==n&&this.index.hasPrefix(a.key)&&e.add(a.display)}add(e){let r=!0;for(let[n,s]of e)for(let a of s)this.index.has(`${se(a.dataTile)}:${n}`)||(r=!1);return r?0:this.layout(e)}},ke=class{constructor(e,r,i,n){this.labelers=new Map,this.scratch=e,this.labelRules=r,this.maxLabeledTiles=i,this.callback=n}add(e,r){let i=this.labelers.get(e);return i||(i=new ve(e,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(e,i)),i.add(r)}getIndex(e){let r=this.labelers.get(e);if(r)return r.index}};var Ar=J(Q(),1);function Ee(t,e,r,i,n,s,a,o,l){let c=performance.now();t.save(),t.miterLimit=2;for(let f of n){if(f.minzoom&&e<f.minzoom||f.maxzoom&&e>f.maxzoom)continue;let d=r.get(f.dataSource||"");if(!!d)for(let p of d){let y=p.data.get(f.dataLayer);if(y===void 0)continue;f.symbolizer.before&&f.symbolizer.before(t,p.z);let _=p.origin,k=p.dim,u=p.scale;if(t.save(),o){t.beginPath();let h=Math.max(_.x-a.x,s.minX-a.x),m=Math.max(_.y-a.y,s.minY-a.y),x=Math.min(_.x-a.x+k,s.maxX-a.x),g=Math.min(_.y-a.y+k,s.maxY-a.y);t.rect(h,m,x-h,g-m),t.clip()}t.translate(_.x-a.x,_.y-a.y);for(let h of y){let m=h.geom,x=h.bbox;x.maxX*u+_.x<s.minX||x.minX*u+_.x>s.maxX||x.minY*u+_.y>s.maxY||x.maxY*u+_.y<s.minY||f.filter&&!f.filter(p.z,h)||(u!==1&&(m=Ye(m,u,new Ar.default(0,0))),f.symbolizer.draw(t,m,p.z,h))}t.restore()}}if(o&&(t.beginPath(),t.rect(s.minX-a.x,s.minY-a.y,s.maxX-s.minX,s.maxY-s.minY),t.clip()),i){let f=i.searchBbox(s,1/0);for(let d of f)if(t.save(),t.translate(d.anchor.x-a.x,d.anchor.y-a.y),d.draw(t),t.restore(),l){t.lineWidth=.5,t.strokeStyle=l,t.fillStyle=l,t.globalAlpha=1,t.fillRect(d.anchor.x-a.x-2,d.anchor.y-a.y-2,4,4);for(let p of d.bboxes)t.strokeRect(p.minX-a.x,p.minY-a.y,p.maxX-p.minX,p.maxY-p.minY)}}return t.restore(),performance.now()-c}var Ue=6378137,Br=85.0511287798,N=Ue*Math.PI,Rr=t=>{let e=Math.PI/180,r=Math.max(Math.min(Br,t.y),-Br),i=Math.sin(r*e);return new ie.default(Ue*t.x*e,Ue*Math.log((1+i)/(1-i))/2)},Mn=t=>{let e=180/Math.PI;return{lat:(2*Math.atan(Math.exp(t.y/Ue))-Math.PI/2)*e,lng:t.x*e/Ue}},Pn=(t,e)=>r=>{let i=Rr(r);return new ie.default((i.x+N)/(N*2),1-(i.y+N)/(N*2)).mult((1<<e)*256).sub(t)},Cn=(t,e)=>r=>{let i=new ie.default(r.x,r.y).add(t).div((1<<e)*256),n=new ie.default(i.x*(N*2)-N,(1-i.y)*(N*2)-N);return Mn(n)},Ft=(t,e)=>{let r=e*(360/t);return Math.log2(r/256)},Mt=class{constructor(e){if(e.theme){let r=tt[e.theme];this.paintRules=je(r),this.labelRules=Xe(r),this.backgroundColor=r.background}else this.paintRules=e.paintRules||[],this.labelRules=e.labelRules||[],this.backgroundColor=e.backgroundColor;this.views=Ie(e),this.debug=e.debug||""}drawContext(e,r,i,n,s){return R(this,null,function*(){let a=Rr(n),l=new ie.default((a.x+N)/(N*2),1-(a.y+N)/(N*2)).clone().mult(B(2,s)*256).sub(new ie.default(r/2,i/2)),c={minX:l.x,minY:l.y,maxX:l.x+r,maxY:l.y+i},f=[];for(let[m,x]of this.views){let g=x.getBbox(s,c);f.push({key:m,promise:g})}let d=yield Promise.all(f.map(m=>m.promise.then(x=>({status:"fulfilled",value:x,key:m.key}),x=>({status:"rejected",value:[],reason:x,key:m.key})))),p=new Map;for(let m of d)m.status==="fulfilled"&&p.set(m.key,m.value);let y=performance.now(),_=new ve(s,e,this.labelRules,16,void 0),k=_.add(p);this.backgroundColor&&(e.save(),e.fillStyle=this.backgroundColor,e.fillRect(0,0,r,i),e.restore());let u=this.paintRules,h=Ee(e,s,p,_.index,u,c,l,!0,this.debug);if(this.debug){e.save(),e.translate(-l.x,-l.y),e.strokeStyle=this.debug,e.fillStyle=this.debug,e.font="12px sans-serif";let m=0;for(let[x,g]of p){for(let b of g){e.strokeRect(b.origin.x,b.origin.y,b.dim,b.dim);let v=b.dataTile;e.fillText(`${x+(x?" ":"")+v.z} ${v.x} ${v.y}`,b.origin.x+4,b.origin.y+14*(1+m))}m++}e.restore()}return{elapsed:performance.now()-y,project:Pn(l,s),unproject:Cn(l,s)}})}drawCanvas(s,a,o){return R(this,arguments,function*(e,r,i,n={}){let l=window.devicePixelRatio,c=e.clientWidth,f=e.clientHeight;e.width===c*l&&e.height===f*l||(e.width=c*l,e.height=f*l),n.lang&&(e.lang=n.lang);let d=e.getContext("2d");if(!d){console.error("Failed to initialize canvas2d context.");return}return d.setTransform(l,0,0,l,0,0),this.drawContext(d,c,f,r,i)})}drawContextBounds(e,r,i,n,s){return R(this,null,function*(){let a=i.x-r.x,o=new ie.default((r.x+i.x)/2,(r.y+i.y)/2);return this.drawContext(e,n,s,o,Ft(a,n))})}drawCanvasBounds(a,o,l,c){return R(this,arguments,function*(e,r,i,n,s={}){let f=i.x-r.x,d=new ie.default((r.x+i.x)/2,(r.y+i.y)/2);return this.drawCanvas(e,d,Ft(f,n),s)})}};var Or=J(Q(),1);var Dn=t=>new Promise(e=>{setTimeout(()=>{e()},t)}),An=t=>t.then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e})),Bn=(t={})=>{class e extends L.GridLayer{constructor(i={}){if(i.noWrap&&!i.bounds&&(i.bounds=[[-90,-180],[90,180]]),i.attribution==null&&(i.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(i),i.theme){let s=tt[i.theme];this.paintRules=je(s),this.labelRules=Xe(s),this.backgroundColor=s.background}else this.paintRules=i.paintRules||[],this.labelRules=i.labelRules||[],this.backgroundColor=i.backgroundColor;this.lastRequestedZ=void 0,this.tasks=i.tasks||[],this.views=Ie(i),this.debug=i.debug;let n=document.createElement("canvas").getContext("2d");this.scratch=n,this.onTilesInvalidated=s=>{for(let a of s)this.rerenderTile(a)},this.labelers=new ke(this.scratch,this.labelRules,16,this.onTilesInvalidated),this.tileSize=256*window.devicePixelRatio,this.tileDelay=i.tileDelay||3,this.lang=i.lang}renderTile(i,n,s,a=()=>{}){return R(this,null,function*(){this.lastRequestedZ=i.z;let o=[];for(let[w,z]of this.views){let T=z.getDisplayTile(i);o.push({key:w,promise:T})}let l=yield Promise.all(o.map(w=>w.promise.then(z=>({status:"fulfilled",value:z,key:w.key}),z=>({status:"rejected",reason:z,key:w.key})))),c=new Map;for(let w of l)w.status==="fulfilled"?c.set(w.key,[w.value]):w.reason.name==="AbortError"||console.error(w.reason);if(n.key!==s||this.lastRequestedZ!==i.z||(yield Promise.all(this.tasks.map(An)),n.key!==s)||this.lastRequestedZ!==i.z)return;let f=this.labelers.add(i.z,c);if(n.key!==s||this.lastRequestedZ!==i.z)return;let d=this.labelers.getIndex(i.z);if(!this._map)return;let p=this._map.getCenter().wrap(),y=this._getTiledPixelBounds(p),k=this._pxBoundsToTileRange(y).getCenter(),u=i.distanceTo(k)*this.tileDelay;if(yield Dn(u),n.key!==s||this.lastRequestedZ!==i.z)return;let h=16,m={minX:256*i.x-h,minY:256*i.y-h,maxX:256*(i.x+1)+h,maxY:256*(i.y+1)+h},x=new Or.default(256*i.x,256*i.y);n.width=this.tileSize,n.height=this.tileSize;let g=n.getContext("2d");if(!g){console.error("Failed to get Canvas context");return}g.setTransform(this.tileSize/256,0,0,this.tileSize/256,0,0),g.clearRect(0,0,256,256),this.backgroundColor&&(g.save(),g.fillStyle=this.backgroundColor,g.fillRect(0,0,256,256),g.restore());let b=0,v=this.paintRules;if(b=Ee(g,i.z,c,this.xray?null:d,v,m,x,!1,this.debug),this.debug){g.save(),g.fillStyle=this.debug,g.font="600 12px sans-serif",g.fillText(`${i.z} ${i.x} ${i.y}`,4,14),g.font="12px sans-serif";let w=28;for(let[z,T]of c){let S=T[0].dataTile;g.fillText(`${z+(z?" ":"")+S.z} ${S.x} ${S.y}`,4,w),w+=14}g.font="600 10px sans-serif",b>8&&(g.fillText(`${b.toFixed()} ms paint`,4,w),w+=14),f>8&&g.fillText(`${f.toFixed()} ms layout`,4,w),g.strokeStyle=this.debug,g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(0,256),g.stroke(),g.lineWidth=.5,g.beginPath(),g.moveTo(0,0),g.lineTo(256,0),g.stroke(),g.restore()}a()})}rerenderTile(i){for(let n in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(n));i===this._tileCoordsToKey(s)&&this.renderTile(s,this._tiles[n].el,i)}}clearLayout(){this.labelers=new ke(this.scratch,this.labelRules,16,this.onTilesInvalidated)}rerenderTiles(){for(let i in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(i)),s=this._tileCoordsToKey(n);this.renderTile(n,this._tiles[i].el,s)}}createTile(i,n){let s=L.DomUtil.create("canvas","leaflet-tile");s.lang=this.lang;let a=this._tileCoordsToKey(i);return s.key=a,this.renderTile(i,s,a,()=>{n(void 0,s)}),s}_removeTile(i){let n=this._tiles[i];!n||(n.el.removed=!0,n.el.key=void 0,L.DomUtil.removeClass(n.el,"leaflet-tile-loaded"),n.el.width=n.el.height=0,L.DomUtil.remove(n.el),delete this._tiles[i],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(i)}))}}return new e(t)};function Pt(t){let e=0,r=0;for(let o of t)e+=o.w*o.h,r=Math.max(r,o.w);t.sort((o,l)=>l.h-o.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,a=0;for(let o of t)for(let l=n.length-1;l>=0;l--){let c=n[l];if(!(o.w>c.w||o.h>c.h)){if(o.x=c.x,o.y=c.y,a=Math.max(a,o.y+o.h),s=Math.max(s,o.x+o.w),o.w===c.w&&o.h===c.h){let f=n.pop();l<n.length&&(n[l]=f)}else o.h===c.h?(c.x+=o.w,c.w-=o.w):o.w===c.w?(c.y+=o.h,c.h-=o.h):(n.push({x:c.x+o.w,y:c.y,w:c.w-o.w,h:o.h}),c.y+=o.h,c.h-=o.h);break}}return{w:s,h:a,fill:e/(s*a)||0}}var Rn=(t,e,r)=>{let i=new FontFace(t,`url(${e})`,{weight:r});return document.fonts.add(i),i.load()},jr=t=>R(void 0,null,function*(){return new Promise((e,r)=>{let i=new Image;i.onload=()=>e(i),i.onerror=()=>r("Invalid SVG"),i.src=t})}),On=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,Ct=class{constructor(e){this.src=e,this.canvas=document.createElement("canvas"),this.mapping=new Map,this.missingBox={x:0,y:0,w:0,h:0}}load(){return R(this,null,function*(){let e=this.src,r=window.devicePixelRatio;e.endsWith(".html")&&(e=yield(yield fetch(e)).text());let i=new window.DOMParser().parseFromString(e,"text/html"),n=Array.from(i.body.children),s=yield jr(`data:image/svg+xml;base64,${btoa(On)}`),a=[{w:s.width*r,h:s.height*r,img:s,id:""}],o=new XMLSerializer;for(let f of n){let p=`data:image/svg+xml;base64,${btoa(o.serializeToString(f))}`,y=yield jr(p);a.push({w:y.width*r,h:y.height*r,img:y,id:f.id})}let l=Pt(a);this.canvas.width=l.w,this.canvas.height=l.h;let c=this.canvas.getContext("2d");if(c)for(let f of a)f.x!==void 0&&f.y!==void 0&&(c.drawImage(f.img,f.x,f.y,f.w,f.h),f.id?this.mapping.set(f.id,{x:f.x,y:f.y,w:f.w,h:f.h}):this.missingBox={x:f.x,y:f.y,w:f.w,h:f.h});return this})}get(e){let r=this.mapping.get(e);return r||(r=this.missingBox),r}};return Hr(jn);})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
